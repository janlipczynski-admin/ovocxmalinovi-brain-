<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Konfekcja per klient â€” OvocxMalinovi</title>
<script src="zakupy-data.js"></script>
<script src="planowanie-data.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700&family=DM+Mono:wght@400;500&display=swap" rel="stylesheet">
<style>
:root{--orange:#fa4211;--purple:#9013fe;--grad:linear-gradient(135deg,#fa4211,#9013fe);--bg:#f7f7f5;--white:#fff;--border:#e8e6e1;--border2:#d8d5ce;--text:#1a1a18;--text-dim:#6b6b65;--text-muted:#a8a8a0;--surface2:#f2f0eb;--green:#16a34a;--green-bg:rgba(22,163,74,.08);--yellow:#d97706;--yellow-bg:rgba(217,119,6,.08);--red:#dc2626;--red-bg:rgba(220,38,38,.08);--shadow:0 1px 3px rgba(0,0,0,.06),0 1px 2px rgba(0,0,0,.04)}
*{margin:0;padding:0;box-sizing:border-box}
body{background:var(--bg);color:var(--text);font-family:'Plus Jakarta Sans',sans-serif;min-height:100vh;font-size:14px}

header{display:flex;align-items:center;justify-content:space-between;padding:12px 32px;background:var(--white);border-bottom:1px solid var(--border);position:sticky;top:0;z-index:200;box-shadow:var(--shadow);gap:12px}
.back-btn{display:flex;align-items:center;gap:7px;text-decoration:none;color:var(--text-dim);font-size:13px;font-weight:500;transition:color .15s;white-space:nowrap}
.back-btn:hover{color:var(--orange)}
.page-title{font-size:15px;font-weight:700}
.btn{display:inline-flex;align-items:center;gap:5px;padding:7px 13px;border-radius:7px;font-size:12px;font-family:'Plus Jakarta Sans',sans-serif;cursor:pointer;transition:all .15s;border:1px solid var(--border2);background:var(--white);color:var(--text-dim);font-weight:500}
.btn:hover{background:var(--surface2)}
.btn-primary{background:var(--grad);color:#fff;border:none;font-weight:600}
.btn-primary:hover{opacity:.9}

.mod-nav{display:flex;background:var(--white);border-bottom:1px solid var(--border);padding:0 32px;gap:2px}
.mod-nav a{display:inline-flex;align-items:center;gap:5px;padding:9px 16px;font-size:12px;font-weight:500;color:var(--text-muted);text-decoration:none;border-bottom:2px solid transparent;transition:all .15s;white-space:nowrap}
.mod-nav a:hover{color:var(--text-dim)}
.mod-nav a.active{color:var(--orange);border-bottom-color:var(--orange);font-weight:600}

.tabs-bar{display:flex;background:var(--white);border-bottom:1px solid var(--border);padding:0 32px}
.tab{display:flex;align-items:center;gap:6px;padding:11px 16px;font-size:12px;font-weight:500;color:var(--text-muted);cursor:pointer;border-bottom:2px solid transparent;transition:all .15s}
.tab:hover{color:var(--text-dim)}
.tab.active{color:var(--orange);border-bottom-color:var(--orange)}

main{padding:20px 32px 100px;max-width:1400px;margin:0 auto}
.tab-content{display:none}
.tab-content.active{display:block}

.page-desc{background:var(--white);border:1px solid var(--border);border-radius:10px;padding:14px 20px;margin-bottom:20px;font-size:13px;color:var(--text-dim);line-height:1.6}
.page-desc strong{color:var(--text)}

/* CLIENT CARDS */
.client-grid{display:flex;flex-direction:column;gap:12px}
.client-card{background:var(--white);border:1px solid var(--border);border-radius:12px;overflow:hidden;box-shadow:var(--shadow)}
.client-head{display:flex;align-items:center;justify-content:space-between;padding:14px 20px;cursor:pointer;user-select:none;gap:16px;transition:background .12s}
.client-head:hover{background:var(--surface2)}
.ch-left{display:flex;align-items:center;gap:10px}
.client-name{font-size:15px;font-weight:700}
.badge-avg{font-size:9px;background:#fef9c3;border:1px solid #fde047;color:#854d0e;padding:2px 7px;border-radius:10px;font-weight:600;text-transform:uppercase;letter-spacing:.04em}
.ch-right{display:flex;align-items:center;gap:20px;font-size:12px;color:var(--text-dim)}
.ch-right strong{color:var(--text);font-variant-numeric:tabular-nums}
.ch-toggle{font-size:10px;color:var(--text-muted);transition:transform .18s;margin-left:4px}
.client-card.open .ch-toggle{transform:rotate(180deg)}
.client-body{display:none;border-top:1px solid var(--border)}
.client-card.open .client-body{display:block}

.pak-table{width:100%;border-collapse:collapse}
.pak-table th{padding:8px 14px;font-size:10px;text-transform:uppercase;letter-spacing:.06em;color:var(--text-muted);font-weight:600;text-align:left;background:var(--surface2);border-bottom:1px solid var(--border)}
.pak-table td{padding:8px 14px;border-bottom:1px solid var(--border);font-size:13px;vertical-align:middle}
.pak-table tbody tr:last-child td{border-bottom:none}
.pak-table tfoot td{background:var(--surface2);font-weight:600;font-size:12px;padding:9px 14px;border-top:1px solid var(--border2)}
.pak-dot{display:inline-block;width:8px;height:8px;border-radius:2px;margin-right:7px;vertical-align:middle;flex-shrink:0}
.pak-name-cell{max-width:360px}
.pak-label{font-weight:500}
.pak-code{font-family:'DM Mono',monospace;font-size:10px;color:var(--text-muted);display:block;margin-top:1px}
.share-wrap{display:flex;align-items:center;gap:4px}
.share-input{width:70px;padding:4px 8px;border:1px solid var(--border2);border-radius:5px;font-family:'DM Mono',monospace;font-size:12px;text-align:right;color:var(--text);background:var(--white);transition:border-color .15s}
.share-input:focus{outline:none;border-color:var(--orange)}
.pct-sign{font-size:11px;color:var(--text-muted)}
.num-cell{font-family:'DM Mono',monospace;font-size:12px}
.sum-warn{font-size:11px;color:var(--red);background:var(--red-bg);padding:6px 14px;display:none}

/* ETYKIETY TAB */
.label-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(320px,1fr));gap:10px}
.label-card{background:var(--white);border:1px solid var(--border);border-radius:10px;padding:14px}
.label-title{font-size:13px;font-weight:600;margin-bottom:2px}
.label-indeks{font-family:'DM Mono',monospace;font-size:10px;color:var(--text-muted);margin-bottom:8px}
.label-clients{display:flex;flex-wrap:wrap;gap:5px}
.client-chip{display:inline-flex;align-items:center;padding:3px 9px;border-radius:20px;font-size:11px;font-weight:500;cursor:pointer;transition:all .12s;border:1px solid var(--border2);background:var(--surface2);color:var(--text-dim);user-select:none}
.client-chip.selected{background:rgba(250,66,17,.1);border-color:rgba(250,66,17,.3);color:var(--orange);font-weight:600}
.client-chip:hover:not(.selected){border-color:var(--border2);background:var(--bg)}

/* SAVE BAR */
.save-bar{position:fixed;bottom:0;left:0;right:0;background:rgba(255,255,255,.95);backdrop-filter:blur(8px);border-top:1px solid var(--border);padding:12px 32px;display:flex;align-items:center;gap:10px;z-index:100;box-shadow:0 -2px 10px rgba(0,0,0,.05)}
.save-status{font-size:12px;color:var(--green);margin-right:auto;font-weight:500}
.save-status.unsaved{color:var(--yellow)}
</style>
</head>
<body>

<header>
  <a href="index.html" class="back-btn">â† Baza wiedzy</a>
  <span class="page-title">Konfekcja per klient</span>
  <span></span>
</header>

<nav class="mod-nav">
  <a href="zakupy-planowanie.html">ğŸ“Š Stan magazynowy</a>
  <a href="zakupy-klienci.html" class="active">ğŸ“¦ Konfekcja per klient</a>
  <a href="zakupy-harmonogram.html">ğŸ“… Harmonogram zakupÃ³w</a>
</nav>

<div class="tabs-bar">
  <div class="tab active" data-tab="kartony" onclick="switchTab('kartony')">ğŸ“¦ Kartony i konfekcja</div>
  <div class="tab" data-tab="etykiety" onclick="switchTab('etykiety')">ğŸ· Etykiety</div>
</div>

<main>

<!-- TAB: KARTONY -->
<div id="tab-kartony" class="tab-content active">
  <div class="page-desc">
    Miks konfekcji (kartonÃ³w) per klient â€” domyÅ›lnie z zestawieÅ„ ZP 2025.
    <strong>UdziaÅ‚y % moÅ¼esz zmieniÄ‡</strong> â€” zostanÄ… zapisane w przeglÄ…darce i uÅ¼yte do obliczeÅ„ w Harmonogramie zakupÃ³w.<br>
    Klienci bez historii w ZP 2025 majÄ… przypisany Å›redni miks ze wszystkich klientÃ³w.
  </div>
  <div class="client-grid" id="client-grid"></div>
</div>

<!-- TAB: ETYKIETY -->
<div id="tab-etykiety" class="tab-content">
  <div class="page-desc">
    Przypisanie etykiet do klientÃ³w â€” informacyjnie, do planowania stanÃ³w buforowych.
    <strong>Kliknij klienta</strong> aby zaznaczyÄ‡ lub odznaczyÄ‡. Zmiany zapisywane razem z kartÄ… konfekcji.
  </div>
  <div class="label-grid" id="label-grid"></div>
</div>

</main>

<div class="save-bar">
  <span class="save-status" id="save-status"></span>
  <button class="btn" onclick="resetAll()">â†º PrzywrÃ³Ä‡ z ZP 2025</button>
  <button class="btn btn-primary" onclick="saveAll()">ğŸ’¾ Zapisz zmiany</button>
</div>

<script>
// â”€â”€ DATA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const ZCP_DEFAULT = (window.ZAKUPY_DATA || {}).zp_client_pak || {};
const SNAP_LABELS = ((window.ZAKUPY_DATA || {}).stany || []).filter(s => s.kategoria === 'etykiety');
const LS_PAK  = 'oxm_klient_pak_v1';
const LS_ETYK = 'oxm_klient_etyk_v1';

const PLAN_DATA_ALL = window.PLAN_DATA || [];
const PLAN_2026 = {};
PLAN_DATA_ALL.filter(r => r.typ === 'klient').forEach(r => {
  PLAN_2026[r.podmiot] = (PLAN_2026[r.podmiot] || 0) + (r.kg || 0);
});
const CLIENTS = Object.keys(PLAN_2026).sort((a, b) =>
  (PLAN_2026[b] || 0) - (PLAN_2026[a] || 0)  // sort by plan volume desc
);

// â”€â”€ DEFAULT ASSIGNMENTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function zcpToShares(paks) {
  const total = paks.reduce((s, v) => s + v.kg_zp, 0);
  return paks
    .map(v => ({ pak: v.pak, kgpk: v.kgpk, share: total > 0 ? +(v.kg_zp / total * 100).toFixed(2) : 0 }))
    .sort((a, b) => b.share - a.share);
}

function buildAvgMix() {
  const avg = {};
  Object.values(ZCP_DEFAULT).forEach(paks => {
    paks.forEach(v => {
      if (!avg[v.pak]) avg[v.pak] = { kg: 0, kgpk: v.kgpk };
      avg[v.pak].kg += v.kg_zp;
      if (!avg[v.pak].kgpk) avg[v.pak].kgpk = v.kgpk;
    });
  });
  const total = Object.values(avg).reduce((s, v) => s + v.kg, 0);
  return Object.entries(avg)
    .map(([pak, v]) => ({ pak, kgpk: v.kgpk, share: total > 0 ? +(v.kg / total * 100).toFixed(2) : 0 }))
    .sort((a, b) => b.share - a.share);
}
const AVG_MIX = buildAvgMix();

function defaultPak() {
  const r = {};
  CLIENTS.forEach(c => {
    r[c] = ZCP_DEFAULT[c]
      ? zcpToShares(ZCP_DEFAULT[c])
      : JSON.parse(JSON.stringify(AVG_MIX));
  });
  return r;
}

function defaultEtyk() {
  const r = {};
  SNAP_LABELS.forEach(l => {
    const n = (l.nazwa || '').toLowerCase();
    const assigned = [];
    if (n.includes('biedronka'))           assigned.push('Biedronka');
    if (n.includes('sanlucar'))            assigned.push('SanLucar');
    if (n.includes('aldi') && n.includes('sanlucar')) { if (!assigned.includes('SanLucar')) assigned.push('SanLucar'); }
    if (n.includes('frutania') || n.includes('rewe'))  assigned.push('Frutania');
    if (n.includes('colruyt') || n.includes('maxima') ||
       (n.includes('aldi') && n.includes('frambozen')) ||
        n.includes('carrefour') || n.includes('60x65') || n.includes('60x80')) {
      if (!assigned.includes('Special Fruit')) assigned.push('Special Fruit');
    }
    if (n.includes('kaufland')) assigned.push('Kaufland');
    if (n.includes('intermarche') || n.includes('inter.') || n.includes('z sadÃ³w')) assigned.push('InterMarche');
    if (n.includes('berry') || n.includes('pirkka')) assigned.push('Berry World');
    if (n.includes('lidl'))               assigned.push('Garden Frutta');
    r[l.indeks] = assigned;
  });
  return r;
}

let PAK = {}, ETYK = {};
try { PAK  = JSON.parse(localStorage.getItem(LS_PAK))  || defaultPak(); } catch(e) { PAK  = defaultPak(); }
try { ETYK = JSON.parse(localStorage.getItem(LS_ETYK)) || defaultEtyk(); } catch(e) { ETYK = defaultEtyk(); }
if (!PAK || typeof PAK !== 'object') PAK = defaultPak();
if (!ETYK || typeof ETYK !== 'object') ETYK = defaultEtyk();
CLIENTS.forEach(c => { if (!PAK[c]) PAK[c] = JSON.parse(JSON.stringify(AVG_MIX)); });

// â”€â”€ HELPERS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function esc(s) {
  return String(s).replace(/[&<>"']/g, c =>
    ({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' }[c])
  );
}
function cid(s) { return s.replace(/[^a-zA-Z0-9]/g, '_'); }

function pakLabel(pak) {
  const typ  = pak.startsWith('PEÅNE')  ? 'Ziel.' : 'Czar.';
  const rodz = pak.includes('KLEJONY') ? 'klej.' : 'skÅ‚.';
  const roz  = pak.includes('MAÅY')    ? 'MaÅ‚y'  : 'DuÅ¼y';
  const ts   = pak.includes('TOPSEAL') ? ' TS'   : '';
  const m    = pak.match(/__(\d+)X(\d+)/);
  return m ? `${roz} ${m[1]}g Ã— ${m[2]} szt/k (${typ} ${rodz}${ts})` : pak;
}

function pakColor(pak) {
  if (pak.startsWith('PEÅNE')  && pak.includes('MAÅY')) return '#16a34a';
  if (pak.startsWith('PEÅNE')  && pak.includes('DUÅ»Y')) return '#2563eb';
  if (pak.startsWith('PROSTE') && pak.includes('MAÅY')) return '#6b7280';
  if (pak.startsWith('PROSTE') && pak.includes('DUÅ»Y')) return '#9013fe';
  return '#a8a8a0';
}

function projCartons(planKg, share, kgpk) {
  return kgpk > 0 ? Math.round(planKg * (share / 100) / kgpk) : 0;
}

// â”€â”€ KARTONY TAB â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderKartons() {
  const grid = document.getElementById('client-grid');
  grid.innerHTML = CLIENTS.map(c => clientCardHTML(c)).join('');
  // Open first card by default
  if (CLIENTS[0]) {
    const body = document.getElementById('cb_' + cid(CLIENTS[0]));
    const card = document.getElementById('cc_' + cid(CLIENTS[0]));
    if (body && card) { body.style.display = 'block'; card.classList.add('open'); }
  }
}

function clientCardHTML(c) {
  const paks   = PAK[c] || [];
  const planKg = PLAN_2026[c] || 0;
  const isAvg  = !ZCP_DEFAULT[c];
  const sum100 = Math.abs(paks.reduce((s, v) => s + v.share, 0) - 100) < 1;
  const totalK = paks.reduce((s, v) => s + projCartons(planKg, v.share, v.kgpk), 0);

  const rows = paks.map((v, i) => {
    const k = projCartons(planKg, v.share, v.kgpk);
    return `<tr>
      <td class="pak-name-cell">
        <span class="pak-dot" style="background:${pakColor(v.pak)}"></span>
        <span class="pak-label">${esc(pakLabel(v.pak))}</span>
        <span class="pak-code">${esc(v.pak)}</span>
      </td>
      <td>
        <div class="share-wrap">
          <input type="number" class="share-input" min="0" max="100" step="0.1" value="${v.share.toFixed(1)}"
            oninput="onShareChange('${esc(c)}',${i},this.value)">
          <span class="pct-sign">%</span>
        </div>
      </td>
      <td class="num-cell">${v.kgpk}</td>
      <td class="num-cell" id="proj_${cid(c)}_${i}">${k.toLocaleString('pl-PL')}</td>
    </tr>`;
  }).join('');

  return `<div class="client-card" id="cc_${cid(c)}">
    <div class="client-head" onclick="toggleCard('${esc(c)}')">
      <div class="ch-left">
        <span class="client-name">${esc(c)}</span>
        ${isAvg ? '<span class="badge-avg">avg mix</span>' : ''}
      </div>
      <div class="ch-right">
        <span>Plan 2026: <strong>${Math.round(planKg).toLocaleString('pl-PL')} kg</strong></span>
        <span>Prognoza: <strong id="ch_tot_${cid(c)}">${totalK.toLocaleString('pl-PL')}</strong> kartonÃ³w</span>
        <span class="ch-toggle">â–¼</span>
      </div>
    </div>
    <div class="client-body" id="cb_${cid(c)}">
      <div class="sum-warn" id="sumwarn_${cid(c)}"${sum100 ? '' : ' style="display:block"'}>
        âš  Suma udziaÅ‚Ã³w â‰  100% â€” sprawdÅº wartoÅ›ci
      </div>
      <table class="pak-table">
        <thead><tr>
          <th>Konfekcja / karton</th>
          <th style="width:130px">UdziaÅ‚ %</th>
          <th style="width:80px">kg/krt</th>
          <th style="width:110px">Kart. 2026</th>
        </tr></thead>
        <tbody>${rows}</tbody>
        <tfoot><tr>
          <td colspan="3" style="text-align:right;padding-right:20px;color:var(--text-dim)">ÅÄ…cznie:</td>
          <td class="num-cell" id="tf_${cid(c)}">${totalK.toLocaleString('pl-PL')}</td>
        </tr></tfoot>
      </table>
    </div>
  </div>`;
}

function toggleCard(c) {
  const card = document.getElementById('cc_' + cid(c));
  const body = document.getElementById('cb_' + cid(c));
  if (!card || !body) return;
  const opening = !card.classList.contains('open');
  card.classList.toggle('open', opening);
  body.style.display = opening ? 'block' : 'none';
}

function onShareChange(c, idx, val) {
  const paks = PAK[c];
  if (!paks || !paks[idx]) return;
  paks[idx].share = parseFloat(val) || 0;
  const planKg = PLAN_2026[c] || 0;

  // Update this row's projection
  const k = projCartons(planKg, paks[idx].share, paks[idx].kgpk);
  const projEl = document.getElementById('proj_' + cid(c) + '_' + idx);
  if (projEl) projEl.textContent = k.toLocaleString('pl-PL');

  // Update totals
  const totalK = paks.reduce((s, v) => s + projCartons(planKg, v.share, v.kgpk), 0);
  const el1 = document.getElementById('ch_tot_' + cid(c));
  const el2 = document.getElementById('tf_' + cid(c));
  if (el1) el1.textContent = totalK.toLocaleString('pl-PL');
  if (el2) el2.textContent = totalK.toLocaleString('pl-PL');

  // Sum validation
  const sumShares = paks.reduce((s, v) => s + v.share, 0);
  const warn = document.getElementById('sumwarn_' + cid(c));
  if (warn) warn.style.display = Math.abs(sumShares - 100) > 1 ? 'block' : 'none';

  markUnsaved();
}

// â”€â”€ ETYKIETY TAB â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderLabels() {
  const grid = document.getElementById('label-grid');
  grid.innerHTML = SNAP_LABELS.map(l => {
    const assigned = ETYK[l.indeks] || [];
    const chips = CLIENTS.map(c =>
      `<span class="client-chip${assigned.includes(c) ? ' selected' : ''}"
        onclick="toggleLabel('${esc(l.indeks)}','${esc(c)}')">${esc(c)}</span>`
    ).join('');
    return `<div class="label-card">
      <div class="label-title">${esc(l.nazwa)}</div>
      <div class="label-indeks">${esc(l.indeks)}</div>
      <div class="label-clients" id="lc_${cid(l.indeks)}">${chips}</div>
    </div>`;
  }).join('');
}

function toggleLabel(indeks, client) {
  if (!ETYK[indeks]) ETYK[indeks] = [];
  const arr = ETYK[indeks];
  const i = arr.indexOf(client);
  if (i >= 0) arr.splice(i, 1); else arr.push(client);
  const container = document.getElementById('lc_' + cid(indeks));
  if (container) {
    const chips = container.querySelectorAll('.client-chip');
    CLIENTS.forEach((c, ci) => {
      if (chips[ci]) chips[ci].classList.toggle('selected', arr.includes(c));
    });
  }
  markUnsaved();
}

// â”€â”€ TABS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function switchTab(id) {
  document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
  document.querySelectorAll('.tab').forEach(el => el.classList.remove('active'));
  document.getElementById('tab-' + id).classList.add('active');
  document.querySelector('[data-tab="' + id + '"]').classList.add('active');
}

// â”€â”€ SAVE / RESET â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function markUnsaved() {
  const el = document.getElementById('save-status');
  if (el) { el.textContent = 'Niezapisane zmiany'; el.className = 'save-status unsaved'; }
}

function saveAll() {
  localStorage.setItem(LS_PAK,  JSON.stringify(PAK));
  localStorage.setItem(LS_ETYK, JSON.stringify(ETYK));
  const el = document.getElementById('save-status');
  if (el) { el.textContent = 'Zapisano!'; el.className = 'save-status'; }
  setTimeout(() => { if (el) el.textContent = ''; }, 2500);
}

function resetAll() {
  if (!confirm('PrzywrÃ³ciÄ‡ udziaÅ‚y i etykiety z ZP 2025?\nTwoje zmiany zostanÄ… utracone.')) return;
  localStorage.removeItem(LS_PAK);
  localStorage.removeItem(LS_ETYK);
  PAK  = defaultPak();
  ETYK = defaultEtyk();
  renderKartons();
  renderLabels();
}

// â”€â”€ INIT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
renderKartons();
renderLabels();
</script>
</body>
</html>
