<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Planowanie Zakup√≥w Opakowa≈Ñ ‚Äî OvocxMalinovi</title>
<script src="zakupy-data.js"></script>
<script src="planowanie-data.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700&family=DM+Mono:wght@400;500&display=swap" rel="stylesheet">
<style>
  :root {
    --orange:#fa4211;--purple:#9013fe;
    --grad:linear-gradient(135deg,#fa4211,#9013fe);
    --bg:#f7f7f5;--white:#fff;
    --border:#e8e6e1;--border2:#d8d5ce;
    --text:#1a1a18;--text-dim:#6b6b65;--text-muted:#a8a8a0;
    --surface2:#f2f0eb;
    --green:#16a34a;--green-bg:rgba(22,163,74,.08);--green-border:rgba(22,163,74,.2);
    --yellow:#d97706;--yellow-bg:rgba(217,119,6,.08);--yellow-border:rgba(217,119,6,.25);
    --red:#dc2626;--red-bg:rgba(220,38,38,.08);--red-border:rgba(220,38,38,.2);
    --blue:#2563eb;
    --shadow:0 1px 3px rgba(0,0,0,.06),0 1px 2px rgba(0,0,0,.04);
    --shadow-md:0 4px 12px rgba(0,0,0,.08),0 2px 4px rgba(0,0,0,.04);
  }
  *{margin:0;padding:0;box-sizing:border-box}
  body{background:var(--bg);color:var(--text);font-family:'Plus Jakarta Sans',sans-serif;min-height:100vh;font-size:14px}

  header{display:flex;align-items:center;justify-content:space-between;padding:13px 32px;background:var(--white);border-bottom:1px solid var(--border);position:sticky;top:0;z-index:200;box-shadow:var(--shadow);gap:12px}
  .back-btn{display:flex;align-items:center;gap:7px;text-decoration:none;color:var(--text-dim);font-size:13px;font-weight:500;transition:color .15s;white-space:nowrap}
  .back-btn:hover{color:var(--orange)}
  .h-center{display:flex;align-items:center;gap:10px;flex:1;justify-content:center}
  .page-title{font-size:16px;font-weight:700}
  .snapshot-pill{font-family:'DM Mono',monospace;font-size:11px;background:var(--surface2);color:var(--text-dim);border:1px solid var(--border2);padding:3px 10px;border-radius:20px}
  .btn{display:inline-flex;align-items:center;gap:5px;padding:7px 13px;border-radius:7px;font-size:12px;font-family:'Plus Jakarta Sans',sans-serif;cursor:pointer;transition:all .15s;border:1px solid var(--border2);background:var(--white);color:var(--text-dim);font-weight:500}
  .btn:hover{background:var(--surface2)}
  .btn-print{background:var(--grad);color:#fff;border:none}
  .btn-print:hover{opacity:.9}

  .tabs-bar{display:flex;background:var(--white);border-bottom:1px solid var(--border);padding:0 32px;overflow-x:auto}
  .tab{display:flex;align-items:center;gap:6px;padding:12px 16px;font-size:12px;font-weight:500;color:var(--text-muted);cursor:pointer;border-bottom:2px solid transparent;transition:all .15s;white-space:nowrap}
  .tab:hover{color:var(--text-dim)}
  .tab.active{color:var(--orange);border-bottom-color:var(--orange)}
  .tab-badge{font-family:'DM Mono',monospace;font-size:9px;background:var(--surface2);color:var(--text-muted);padding:1px 6px;border-radius:10px;border:1px solid var(--border)}
  .tab.active .tab-badge{background:rgba(250,66,17,.1);color:var(--orange);border-color:rgba(250,66,17,.2)}

  main{padding:20px 32px;max-width:1600px;margin:0 auto}
  .tab-content{display:none}
  .tab-content.active{display:block}

  /* ALERT CARDS */
  .alert-row{display:grid;grid-template-columns:repeat(4,1fr);gap:10px;margin-bottom:20px}
  .alert-card{background:var(--white);border:1px solid var(--border);border-radius:10px;padding:14px 18px;border-left:4px solid var(--border)}
  .alert-card.red{border-left-color:var(--red);background:var(--red-bg)}
  .alert-card.yellow{border-left-color:var(--yellow);background:var(--yellow-bg)}
  .alert-card.green{border-left-color:var(--green);background:var(--green-bg)}
  .alert-label{font-family:'DM Mono',monospace;font-size:9px;text-transform:uppercase;letter-spacing:.08em;color:var(--text-muted);margin-bottom:5px}
  .alert-val{font-size:22px;font-weight:700;font-variant-numeric:tabular-nums}
  .alert-sub{font-size:10px;color:var(--text-muted);margin-top:2px}

  /* FILTERS */
  .filters{display:flex;flex-wrap:wrap;gap:8px;margin-bottom:16px;align-items:flex-end}
  .filter-group{display:flex;flex-direction:column;gap:3px}
  .filter-label{font-family:'DM Mono',monospace;font-size:9px;text-transform:uppercase;letter-spacing:.08em;color:var(--text-muted)}
  select,input[type=number],input[type=text]{background:var(--white);border:1px solid var(--border2);border-radius:7px;padding:6px 10px;font-size:12px;font-family:'Plus Jakarta Sans',sans-serif;color:var(--text);outline:none;transition:border-color .15s}
  select:focus,input:focus{border-color:var(--orange)}
  select{cursor:pointer;min-width:130px}
  input[type=number]{min-width:80px}
  .filter-sep{width:1px;height:36px;background:var(--border);align-self:flex-end;margin:0 4px}

  /* TABLE */
  .table-wrap{background:var(--white);border:1px solid var(--border);border-radius:10px;overflow:hidden;margin-bottom:20px}
  .table-header{display:flex;align-items:center;justify-content:space-between;padding:12px 18px;border-bottom:1px solid var(--border)}
  .table-title{font-size:13px;font-weight:600}
  .table-count{font-family:'DM Mono',monospace;font-size:10px;color:var(--text-muted)}
  table{width:100%;border-collapse:collapse}
  th{font-family:'DM Mono',monospace;font-size:9px;text-transform:uppercase;letter-spacing:.08em;color:var(--text-muted);padding:8px 12px;text-align:left;border-bottom:1px solid var(--border);background:var(--surface2);font-weight:500;white-space:nowrap}
  th.num,td.num{text-align:right}
  td{padding:7px 12px;border-bottom:1px solid var(--border);font-size:12px;vertical-align:middle}
  tr:last-child td{border-bottom:none}
  tr:hover td{background:var(--surface2)}

  /* STATUS BADGES */
  .status{font-family:'DM Mono',monospace;font-size:10px;font-weight:600;padding:3px 8px;border-radius:5px;white-space:nowrap}
  .status-ok{background:var(--green-bg);color:var(--green);border:1px solid var(--green-border)}
  .status-warn{background:var(--yellow-bg);color:var(--yellow);border:1px solid var(--yellow-border)}
  .status-crit{background:var(--red-bg);color:var(--red);border:1px solid var(--red-border)}
  .status-na{background:var(--surface2);color:var(--text-muted);border:1px solid var(--border)}

  /* NUM */
  .num-big{font-family:'DM Mono',monospace;font-size:12px;font-weight:600}
  .num-muted{font-family:'DM Mono',monospace;font-size:11px;color:var(--text-muted)}
  .num-order{font-family:'DM Mono',monospace;font-size:12px;font-weight:700;color:var(--orange)}

  /* BAR */
  .bar-cell{display:flex;align-items:center;gap:6px}
  .bar-bg{flex:1;height:5px;background:var(--surface2);border-radius:3px;overflow:hidden;min-width:50px}
  .bar-fill-green{height:100%;background:var(--green);border-radius:3px}
  .bar-fill-yellow{height:100%;background:var(--yellow);border-radius:3px}
  .bar-fill-red{height:100%;background:var(--red);border-radius:3px}
  .bar-pct{font-family:'DM Mono',monospace;font-size:10px;color:var(--text-muted);min-width:36px;text-align:right}

  /* LABEL MACHINE */
  .machine-tag{font-family:'DM Mono',monospace;font-size:9px;padding:2px 6px;border-radius:4px;border:1px solid var(--border);background:var(--surface2);color:var(--text-dim)}
  .machine-special{background:rgba(144,19,254,.08);color:var(--purple);border-color:rgba(144,19,254,.2)}

  /* ORDER FORM */
  .order-header{background:var(--surface2);border:1px solid var(--border2);border-radius:10px;padding:16px 20px;margin-bottom:16px}
  .order-meta{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-top:10px}
  .order-meta-item{font-size:12px}
  .order-meta-label{font-family:'DM Mono',monospace;font-size:9px;text-transform:uppercase;letter-spacing:.08em;color:var(--text-muted);display:block;margin-bottom:3px}
  .order-section{margin-bottom:24px}
  .order-section-title{font-size:12px;font-weight:700;text-transform:uppercase;letter-spacing:.06em;color:var(--text-dim);margin-bottom:8px;padding-bottom:6px;border-bottom:2px solid var(--border)}
  .order-note{font-size:11px;color:var(--text-dim);background:rgba(250,66,17,.06);border:1px solid rgba(250,66,17,.15);border-radius:7px;padding:10px 14px;margin-bottom:12px;line-height:1.6}

  /* SNAPSHOT INFO */
  .snapshot-note{display:flex;align-items:center;gap:8px;font-size:11px;color:var(--text-dim);background:rgba(37,99,235,.06);border:1px solid rgba(37,99,235,.15);border-radius:7px;padding:9px 14px;margin-bottom:16px}

  /* SETTINGS BOX */
  .settings-box{background:var(--white);border:1px solid var(--border);border-radius:10px;padding:14px 18px;margin-bottom:16px;display:flex;gap:20px;flex-wrap:wrap;align-items:flex-end}
  .settings-box .filter-label{margin-bottom:4px}

  @media(max-width:900px){
    main{padding:14px 16px}
    header{padding:11px 16px}
    .tabs-bar{padding:0 16px}
    .alert-row{grid-template-columns:repeat(2,1fr)}
    .order-meta{grid-template-columns:1fr}
  }
  @media print{
    header,.tabs-bar,.filters,.settings-box,.btn,th{-webkit-print-color-adjust:exact;print-color-adjust:exact}
    .tab-content{display:block !important}
    .tabs-bar,.tab:not(.active),.back-btn,.btn{display:none}
    #tab-arkusz{display:block !important}
  }
</style>
</head>
<body>

<header>
  <a href="index.html" class="back-btn">
    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 12H5M12 19l-7-7 7-7"/></svg>
    Dashboard
  </a>
  <div class="h-center">
    <span class="page-title">Planowanie Zakup√≥w Opakowa≈Ñ</span>
    <span class="snapshot-pill">Stan: 25.02.2026</span>
  </div>
  <div style="display:flex;gap:7px">
    <button class="btn btn-print" onclick="window.print()">üñ® Drukuj arkusz</button>
  </div>
</header>

<div class="tabs-bar">
  <div class="tab active" data-tab="dashboard" onclick="switchTab('dashboard')">
    üö¶ Dashboard
    <span class="tab-badge" id="badge-dashboard">‚Äî</span>
  </div>
  <div class="tab" data-tab="kartony" onclick="switchTab('kartony')">
    üì¶ Kartony zbiorcze
    <span class="tab-badge" id="badge-kartony">‚Äî</span>
  </div>
  <div class="tab" data-tab="etykiety" onclick="switchTab('etykiety')">
    üè∑ Etykiety
    <span class="tab-badge" id="badge-etykiety">‚Äî</span>
  </div>
  <div class="tab" data-tab="arkusz" onclick="switchTab('arkusz')">
    üìã Arkusz zam√≥wie≈Ñ
  </div>
</div>

<main>

<!-- ‚ïê‚ïê‚ïê TAB 1: DASHBOARD ‚ïê‚ïê‚ïê -->
<div id="tab-dashboard" class="tab-content active">

  <div class="snapshot-note">
    ‚ÑπÔ∏è Stan magazynowy wg snapshotu z <strong>25.02.2026</strong>.
    Zu≈ºycie 2025 z zestawie≈Ñ proceduralnych (01.01‚Äì26.11.2025).
    Prognoza 2026 = zu≈ºycie 2025 √ó wsp√≥≈Çczynnik wzrostu (edytowalny poni≈ºej).
  </div>

  <div class="settings-box">
    <div class="filter-group">
      <div class="filter-label">Plan sprzeda≈ºy 2026 (klienci)</div>
      <div id="plan-display" style="font-family:'DM Mono',monospace;font-size:14px;font-weight:700;padding:6px 10px;background:var(--surface2);border:1px solid var(--border2);border-radius:7px;color:var(--text)">‚Äî</div>
    </div>
    <div class="filter-group">
      <div class="filter-label">Bufor u dostawcy (miesiƒÖce)</div>
      <select id="bufor-mies" onchange="refreshAll()">
        <option value="2" selected>2 miesiƒÖce</option>
        <option value="1">1 miesiƒÖc</option>
        <option value="3">3 miesiƒÖce</option>
      </select>
    </div>
    <div class="filter-group">
      <div class="filter-label">Czas realizacji (dni)</div>
      <input type="number" id="lead-time" value="21" min="1" max="60" oninput="refreshAll()" style="min-width:70px">
    </div>
    <div style="font-size:11px;color:var(--text-muted);align-self:flex-end;padding-bottom:7px;max-width:380px;line-height:1.6">
      Plan pobierany z <strong>Planowanie + sprzeda≈º 2026</strong>.<br>
      Proporcje opakowa≈Ñ z zestawie≈Ñ proc. 2025 (mix opak.).<br>
      Bufor = ilo≈õƒá ze wszystkich magazyn√≥w na N miesiƒôcy sezonu.
    </div>
  </div>

  <div class="alert-row" id="alert-row">
    <div class="alert-card red"><div class="alert-label">Krytyczne ‚Äî brak buforu</div><div class="alert-val" id="d-crit">‚Äî</div><div class="alert-sub">pozycji wymaga natychmiastowego zam√≥wienia</div></div>
    <div class="alert-card yellow"><div class="alert-label">Uwaga ‚Äî poni≈ºej buforu</div><div class="alert-val" id="d-warn">‚Äî</div><div class="alert-sub">pozycji ‚Äî zam√≥w w ciƒÖgu tygodnia</div></div>
    <div class="alert-card green"><div class="alert-label">OK ‚Äî bufor zapewniony</div><div class="alert-val" id="d-ok">‚Äî</div><div class="alert-sub">pozycji ‚Äî stan wystarczajƒÖcy</div></div>
    <div class="alert-card"><div class="alert-label">≈ÅƒÖczne zam√≥wienie</div><div class="alert-val grad" id="d-total-order" style="background:var(--grad);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text">‚Äî</div><div class="alert-sub">pozycji do zam√≥wienia (kartony + etykiety)</div></div>
  </div>

  <div class="table-wrap">
    <div class="table-header">
      <span class="table-title">Kartony zbiorcze ‚Äî status buforu</span>
      <span class="table-count" id="d-kart-count">‚Äî</span>
    </div>
    <div style="overflow-x:auto">
      <table>
        <thead><tr>
          <th>Karton</th>
          <th class="num">CHO</th>
          <th class="num">≈ÅOB</th>
          <th class="num">STR</th>
          <th class="num">WYS</th>
          <th class="num">RAZEM</th>
          <th class="num">Bufor 2M</th>
          <th class="num">Zam√≥wiƒá</th>
          <th>Status</th>
        </tr></thead>
        <tbody id="d-kart-body"></tbody>
      </table>
    </div>
  </div>

  <div class="table-wrap">
    <div class="table-header">
      <span class="table-title">Etykiety ‚Äî status buforu</span>
      <span class="table-count" id="d-et-count">‚Äî</span>
    </div>
    <div style="overflow-x:auto">
      <table>
        <thead><tr>
          <th>Etykieta</th>
          <th class="num">CHO</th>
          <th class="num">≈ÅOB</th>
          <th class="num">STR</th>
          <th class="num">WYS</th>
          <th class="num">RAZEM</th>
          <th class="num">Bufor 2M</th>
          <th class="num">Zam√≥wiƒá</th>
          <th>Status / Maszyna</th>
        </tr></thead>
        <tbody id="d-et-body"></tbody>
      </table>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê TAB 2: KARTONY ‚ïê‚ïê‚ïê -->
<div id="tab-kartony" class="tab-content">

  <div class="snapshot-note">
    ‚ÑπÔ∏è Dane zestawie≈Ñ proceduralnych dajƒÖ ≈ÇƒÖczny wolumen sezonu.
    Zu≈ºycie karton√≥w = wolumen kg √∑ kg/karton (wed≈Çug kodu opakowania).
    Mapowanie kod√≥w opakowa≈Ñ na nazwane kartony jest przybli≈ºone ‚Äî weryfikuj z dzia≈Çem magazynowym.
  </div>

  <div class="filters">
    <div class="filter-group">
      <div class="filter-label">Magazyn</div>
      <select id="kart-mag" onchange="renderKartony()">
        <option value="">Wszystkie</option>
        <option value="Chodzie≈º">Chodzie≈º</option>
        <option value="≈Åob≈ºenica">≈Åob≈ºenica</option>
        <option value="Str√≥≈ºewo">Str√≥≈ºewo</option>
        <option value="Wyszynki">Wyszynki</option>
      </select>
    </div>
    <div class="filter-group">
      <div class="filter-label">Status</div>
      <select id="kart-status" onchange="renderKartony()">
        <option value="">Wszystkie</option>
        <option value="crit">Krytyczne</option>
        <option value="warn">Uwaga</option>
        <option value="ok">OK</option>
      </select>
    </div>
    <div class="filter-sep"></div>
    <div class="filter-group">
      <div class="filter-label">Szukaj</div>
      <input type="text" id="kart-search" placeholder="Nazwa kartonu..." oninput="renderKartony()" style="min-width:200px">
    </div>
  </div>

  <div class="table-wrap">
    <div class="table-header">
      <span class="table-title">Plan zakup√≥w ‚Äî Kartony zbiorcze 2026</span>
      <span class="table-count" id="kart-count">‚Äî</span>
    </div>
    <div style="overflow-x:auto">
      <table>
        <thead><tr>
          <th>Nazwa kartonu</th>
          <th class="num">Chodzie≈º</th>
          <th class="num">≈Åob≈ºenica</th>
          <th class="num">Str√≥≈ºewo</th>
          <th class="num">Wyszynki</th>
          <th class="num">Razem stan</th>
          <th class="num">Bufor 2M</th>
          <th class="num">DO ZAM√ìWIENIA</th>
          <th>Status</th>
          <th>Pokrycie</th>
        </tr></thead>
        <tbody id="kart-body"></tbody>
      </table>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê TAB 3: ETYKIETY ‚ïê‚ïê‚ïê -->
<div id="tab-etykiety" class="tab-content">

  <div class="order-note">
    ‚ö†Ô∏è <strong>Etykieciarka ≈Åob≈ºenica</strong> ma inne parametry ni≈º pozosta≈Çe magazyny.<br>
    Przy zamawianiu etykiet dla ≈Åob≈ºenicy podaj: <strong>Gilza: 76 mm / Naw√≥j: 500 m</strong>.<br>
    Dla pozosta≈Çych magazyn√≥w (Chodzie≈º, Str√≥≈ºewo, Wyszynki): <strong>Gilza: 40 mm / Naw√≥j: 300 m</strong>.
  </div>

  <div class="filters">
    <div class="filter-group">
      <div class="filter-label">Magazyn</div>
      <select id="et-mag" onchange="renderEtykiety()">
        <option value="">Wszystkie</option>
        <option value="Chodzie≈º">Chodzie≈º</option>
        <option value="≈Åob≈ºenica">≈Åob≈ºenica</option>
        <option value="Str√≥≈ºewo">Str√≥≈ºewo</option>
        <option value="Wyszynki">Wyszynki</option>
      </select>
    </div>
    <div class="filter-group">
      <div class="filter-label">Status</div>
      <select id="et-status" onchange="renderEtykiety()">
        <option value="">Wszystkie</option>
        <option value="crit">Krytyczne</option>
        <option value="warn">Uwaga</option>
        <option value="ok">OK</option>
      </select>
    </div>
    <div class="filter-sep"></div>
    <div class="filter-group">
      <div class="filter-label">Szukaj</div>
      <input type="text" id="et-search" placeholder="Nazwa etykiety..." oninput="renderEtykiety()" style="min-width:200px">
    </div>
  </div>

  <div class="table-wrap">
    <div class="table-header">
      <span class="table-title">Plan zakup√≥w ‚Äî Etykiety 2026</span>
      <span class="table-count" id="et-count">‚Äî</span>
    </div>
    <div style="overflow-x:auto">
      <table>
        <thead><tr>
          <th>Nazwa etykiety</th>
          <th class="num">Chodzie≈º</th>
          <th class="num">≈Åob≈ºenica</th>
          <th class="num">Str√≥≈ºewo</th>
          <th class="num">Wyszynki</th>
          <th class="num">Razem stan</th>
          <th class="num">Bufor 2M</th>
          <th class="num">DO ZAM√ìWIENIA</th>
          <th>Maszyna / Status</th>
        </tr></thead>
        <tbody id="et-body"></tbody>
      </table>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê TAB 4: ARKUSZ ZAM√ìWIE≈É ‚ïê‚ïê‚ïê -->
<div id="tab-arkusz" class="tab-content">

  <div class="order-header">
    <div style="font-size:15px;font-weight:700">Arkusz zam√≥wieniowy ‚Äî OvocxMalinovi sp. z o.o.</div>
    <div class="order-meta">
      <div class="order-meta-item"><span class="order-meta-label">Data sporzƒÖdzenia</span><span id="ark-data">25.02.2026</span></div>
      <div class="order-meta-item"><span class="order-meta-label">Snapshot stanu magazynowego</span><span>25.02.2026</span></div>
      <div class="order-meta-item"><span class="order-meta-label">Czas realizacji dostaw</span><span id="ark-lead">21 dni</span></div>
    </div>
  </div>

  <div class="order-note">
    üìã Poni≈ºsze zestawienie zawiera <strong>wy≈ÇƒÖcznie pozycje wymagajƒÖce zam√≥wienia</strong> (stan poni≈ºej buforu 2-miesiƒôcznego).
    Ilo≈õci do zam√≥wienia to sumy dla wszystkich magazyn√≥w (bufor centralny u dostawcy).
    Przed wys≈Çaniem zam√≥wienia <strong>zweryfikuj ilo≈õci i podziel dostawy wg potrzeb poszczeg√≥lnych magazyn√≥w</strong>.
  </div>

  <div class="order-section">
    <div class="order-section-title">üì¶ Opakowania zbiorcze (kartony)</div>
    <div id="ark-kart-note" class="order-note" style="display:none"></div>
    <table id="ark-kart-table" style="border-collapse:collapse;width:100%;font-size:12px">
      <thead>
        <tr style="background:var(--surface2)">
          <th style="padding:8px 12px;text-align:left;border:1px solid var(--border2);font-family:'DM Mono',monospace;font-size:9px;text-transform:uppercase">LP</th>
          <th style="padding:8px 12px;text-align:left;border:1px solid var(--border2);font-family:'DM Mono',monospace;font-size:9px;text-transform:uppercase">Nazwa</th>
          <th style="padding:8px 12px;text-align:right;border:1px solid var(--border2);font-family:'DM Mono',monospace;font-size:9px;text-transform:uppercase">Stan TOTAL</th>
          <th style="padding:8px 12px;text-align:right;border:1px solid var(--border2);font-family:'DM Mono',monospace;font-size:9px;text-transform:uppercase">Bufor 2M</th>
          <th style="padding:8px 12px;text-align:right;border:1px solid var(--border2);font-family:'DM Mono',monospace;font-size:9px;text-transform:uppercase">ZAM√ìWIƒÜ (szt)</th>
          <th style="padding:8px 12px;text-align:left;border:1px solid var(--border2);font-family:'DM Mono',monospace;font-size:9px;text-transform:uppercase">Uwagi</th>
        </tr>
      </thead>
      <tbody id="ark-kart-body"></tbody>
    </table>
  </div>

  <div class="order-section">
    <div class="order-section-title">üè∑ Etykiety</div>
    <div class="order-note">
      <strong>≈Åob≈ºenica ‚Äî inna etykieciarka:</strong> Gilza 76 mm / Naw√≥j 500 m<br>
      <strong>Chodzie≈º, Str√≥≈ºewo, Wyszynki:</strong> Gilza 40 mm / Naw√≥j 300 m<br>
      Pamiƒôtaj o podaniu parametr√≥w przy zam√≥wieniu!
    </div>
    <table id="ark-et-table" style="border-collapse:collapse;width:100%;font-size:12px">
      <thead>
        <tr style="background:var(--surface2)">
          <th style="padding:8px 12px;text-align:left;border:1px solid var(--border2);font-family:'DM Mono',monospace;font-size:9px;text-transform:uppercase">LP</th>
          <th style="padding:8px 12px;text-align:left;border:1px solid var(--border2);font-family:'DM Mono',monospace;font-size:9px;text-transform:uppercase">Nazwa etykiety</th>
          <th style="padding:8px 12px;text-align:right;border:1px solid var(--border2);font-family:'DM Mono',monospace;font-size:9px;text-transform:uppercase">Stan TOTAL</th>
          <th style="padding:8px 12px;text-align:right;border:1px solid var(--border2);font-family:'DM Mono',monospace;font-size:9px;text-transform:uppercase">Bufor 2M</th>
          <th style="padding:8px 12px;text-align:right;border:1px solid var(--border2);font-family:'DM Mono',monospace;font-size:9px;text-transform:uppercase">ZAM√ìWIƒÜ (szt)</th>
          <th style="padding:8px 12px;text-align:left;border:1px solid var(--border2);font-family:'DM Mono',monospace;font-size:9px;text-transform:uppercase">Gilza / Naw√≥j</th>
          <th style="padding:8px 12px;text-align:left;border:1px solid var(--border2);font-family:'DM Mono',monospace;font-size:9px;text-transform:uppercase">Magazyn dostawy</th>
        </tr>
      </thead>
      <tbody id="ark-et-body"></tbody>
    </table>
  </div>

  <div class="order-section">
    <div class="order-section-title">üìç Adresy magazyn√≥w (miejsca dostawy)</div>
    <div id="ark-adresy" style="display:grid;grid-template-columns:repeat(2,1fr);gap:12px;margin-top:8px"></div>
  </div>
</div>

</main>

<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê DATA
const D = window.ZAKUPY_DATA;
const MAGS = D.magazyny; // ['Chodzie≈º','≈Åob≈ºenica','Str√≥≈ºewo','Wyszynki']
const SNAP_STANY = D.stany;
const ZP = D.zp_stats;

// Season months count (Apr-Nov = 8)
const SEASON_MONTHS = 8;

// ‚îÄ‚îÄ‚îÄ Helpers ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function fmtN(n) {
  if (n == null || isNaN(n)) return '‚Äî';
  return Math.round(n).toLocaleString('pl-PL');
}
function fmtNK(n) {  // thousands with "k"
  if (!n) return '‚Äî';
  return n >= 1000 ? (n/1000).toFixed(0)+'k' : n.toString();
}

function getParam() {
  const buforM = parseInt(document.getElementById('bufor-mies').value) || 2;
  const lead   = parseInt(document.getElementById('lead-time').value) || 21;
  return {buforM, lead};
}

// ‚îÄ‚îÄ‚îÄ Plan 2026 z PLAN_DATA (planowanie-data.js) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const PLAN_DATA_ALL = window.PLAN_DATA || [];
// ≈ÅƒÖczny plan klient√≥w 2026 [kg] ‚Äî podstawa do oblicze≈Ñ
const PLAN_2026_KG = PLAN_DATA_ALL
  .filter(r => r.typ === 'klient')
  .reduce((s, r) => s + (r.kg || 0), 0);

// Plan wg owocu (normalizacja nazw: "Truskawka tunelowa" ‚Üí "Truskawka")
function normOwoc(o) {
  if (!o) return 'Inne';
  return o.replace(' tunelowa','').replace(' szklarniowa','').replace(' letnia','').trim();
}
const PLAN_2026_BY_OWOC = {};
PLAN_DATA_ALL.filter(r => r.typ === 'klient').forEach(r => {
  const o = normOwoc(r.owoc);
  PLAN_2026_BY_OWOC[o] = (PLAN_2026_BY_OWOC[o] || 0) + (r.kg || 0);
});

// ‚îÄ‚îÄ‚îÄ ZP 2025: proporcje opakowa≈Ñ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// ≈ÅƒÖczne kg ze wszystkich pak_kod√≥w w ZP 2025
const ZP_TOTAL_KG = ZP.reduce((s, z) => s + (z.kg_2025 || 0), 0);

// Dla ka≈ºdego pak_kodu: udzia≈Ç [0..1] w ≈ÇƒÖcznym kg 2025
// Proj. 2026 kg dla pak_kodu = udzia≈Ç √ó PLAN_2026_KG
// Proj. 2026 karton√≥w = proj_kg / kgpk

// Grupowanie pak_kod√≥w na named carton types
function projCartonsForGroup(filterFn) {
  let total = 0;
  ZP.forEach(z => {
    if (!filterFn(z)) return;
    const share = ZP_TOTAL_KG > 0 ? z.kg_2025 / ZP_TOTAL_KG : 0;
    const proj_kg = share * PLAN_2026_KG;
    const kgpk = z.kgpk || 0;
    if (kgpk > 0) total += proj_kg / kgpk;
  });
  return Math.round(total);
}

// Proj. 2026 karton√≥w per named carton (stany mag name ‚Üí filter ZP)
function projCartons2026(nazwa) {
  const n = nazwa.toLowerCase();
  if (n.includes('ma≈Çy czarny') || n.includes('apla'))
    return projCartonsForGroup(z => z.typ === 'PROSTE' && z.rozmiar === 'MA≈ÅY');
  if (n.includes('ma≈Çy') && n.includes('biedronka'))
    return Math.round(projCartonsForGroup(z => z.typ === 'PE≈ÅNE' && z.rozmiar === 'MA≈ÅY') * 0.4);
  if (n.includes('ma≈Çy') && (n.includes('zielona') || n.includes('lidl')))
    return Math.round(projCartonsForGroup(z => z.typ === 'PE≈ÅNE' && z.rozmiar === 'MA≈ÅY') * 0.6);
  if (n.includes('du≈ºy czarny') && n.includes('klejony'))
    return projCartonsForGroup(z => z.typ === 'PROSTE' && z.rozmiar === 'DU≈ªY' && z.rodzaj === 'KLEJONY');
  if (n.includes('du≈ºy czarny') && n.includes('sk≈Çadania'))
    return projCartonsForGroup(z => z.typ === 'PROSTE' && z.rozmiar === 'DU≈ªY' && z.rodzaj === 'SK≈ÅADANY');
  if (n.includes('du≈ºy') && n.includes('zielony') && n.includes('klejony'))
    return projCartonsForGroup(z => z.typ === 'PE≈ÅNE' && z.rozmiar === 'DU≈ªY' && z.rodzaj === 'KLEJONY');
  if (n.includes('du≈ºy') && n.includes('zielony') && n.includes('sk≈Çadania'))
    return Math.round(projCartonsForGroup(z => z.typ === 'PE≈ÅNE' && z.rozmiar === 'DU≈ªY' && z.rodzaj === 'SK≈ÅADANY') * 0.5);
  if (n.includes('du≈ºy') && n.includes('biedronka'))
    return Math.round(projCartonsForGroup(z => z.typ === 'PE≈ÅNE' && z.rozmiar === 'DU≈ªY' && z.rodzaj === 'SK≈ÅADANY') * 0.5);
  if (n.includes('du≈ºy') && n.includes('szary'))
    return Math.round(projCartonsForGroup(z => z.typ === 'PE≈ÅNE' && z.rozmiar === 'DU≈ªY') * 0.15);
  return null;
}

// Proj. 2026 etykiet: ≈ÇƒÖcznie
// labels per kg = z ZP 2025: Œ£(kg_2025 * szt/waga_g) / ZP_TOTAL_KG
const ZP_LABELS_PER_KG = ZP_TOTAL_KG > 0
  ? ZP.reduce((s, z) => {
      if (z.szt && z.waga_g && z.kg_2025)
        return s + z.kg_2025 * (z.szt / (z.waga_g / 1000)) / ZP_TOTAL_KG;
      return s;
    }, 0)
  : 0;

const PROJ_LABELS_2026_TOTAL = Math.round(PLAN_2026_KG * ZP_LABELS_PER_KG);

// Per etykieta: proporcja ze stan√≥w magazynowych
function projLabels2026(indeks, totalLabelStany) {
  const item = SNAP_STANY.find(i => i.indeks === indeks);
  if (!item || !totalLabelStany || PROJ_LABELS_2026_TOTAL === 0) return null;
  return Math.round((item.total / totalLabelStany) * PROJ_LABELS_2026_TOTAL);
}

// ‚îÄ‚îÄ‚îÄ Build planning rows ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function buildRows(kategoria) {
  const {buforM} = getParam();
  const items = SNAP_STANY.filter(i => i.kategoria === kategoria);

  const totalLabelStany = kategoria === 'etykiety'
    ? items.reduce((s, i) => s + (i.total || 0), 0) : 0;

  return items.map(item => {
    const stock = item.total || 0;
    const stockByMag = item.by_mag || {};

    let proj2026 = null;
    if (kategoria === 'kartony') {
      proj2026 = projCartons2026(item.nazwa);
    } else if (kategoria === 'etykiety') {
      proj2026 = projLabels2026(item.indeks, totalLabelStany);
    }

    const monthlyNeed = proj2026 != null ? Math.round(proj2026 / SEASON_MONTHS) : null;
    const bufferNeed  = monthlyNeed != null ? monthlyNeed * buforM : null;
    const toOrder     = bufferNeed != null ? Math.max(0, bufferNeed - stock) : null;

    let status = 'na';
    if (bufferNeed != null) {
      const cover = bufferNeed > 0 ? stock / bufferNeed : 1;
      if (cover >= 1) status = 'ok';
      else if (cover >= 0.5) status = 'warn';
      else status = 'crit';
    }

    return { indeks: item.indeks, nazwa: item.nazwa, stockByMag, stock,
             proj2026, bufferNeed, toOrder, status };
  });
}

function statusBadge(s) {
  if (s === 'ok')   return '<span class="status status-ok">‚úì OK</span>';
  if (s === 'warn') return '<span class="status status-warn">‚ö† UWAGA</span>';
  if (s === 'crit') return '<span class="status status-crit">‚úó KRYTYCZNE</span>';
  return '<span class="status status-na">‚Äî brak est.</span>';
}

function coverBar(stock, bufferNeed) {
  if (!bufferNeed || bufferNeed <= 0) return '';
  const pct = Math.min(100, Math.round(stock / bufferNeed * 100));
  const cls = pct >= 100 ? 'bar-fill-green' : pct >= 50 ? 'bar-fill-yellow' : 'bar-fill-red';
  return `<div class="bar-cell">
    <div class="bar-bg"><div class="${cls}" style="width:${pct}%"></div></div>
    <span class="bar-pct">${pct}%</span>
  </div>`;
}

function magVal(byMag, mag) {
  const v = byMag[mag] || 0;
  return v > 0 ? `<span class="num-big">${fmtN(v)}</span>` : '<span class="num-muted">‚Äî</span>';
}

// ‚îÄ‚îÄ‚îÄ Etykieciarka tag ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function machineTags(byMag) {
  const lob = (byMag['≈Åob≈ºenica'] || 0) > 0;
  const rest = (['Chodzie≈º','Str√≥≈ºewo','Wyszynki'].some(m => (byMag[m]||0) > 0));
  let tags = '';
  if (rest) tags += '<span class="machine-tag">Std 40mm/300m</span> ';
  if (lob)  tags += '<span class="machine-tag machine-special">≈ÅOB 76mm/500m</span>';
  return tags || '‚Äî';
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê RENDER FUNCTIONS

function renderDashboard() {
  const kartRows = buildRows('kartony');
  const etRows   = buildRows('etykiety');
  const all = [...kartRows, ...etRows];

  const crit = all.filter(r => r.status === 'crit').length;
  const warn = all.filter(r => r.status === 'warn').length;
  const ok   = all.filter(r => r.status === 'ok').length;
  const toOrd = all.filter(r => r.toOrder && r.toOrder > 0).length;

  document.getElementById('d-crit').textContent = crit;
  document.getElementById('d-warn').textContent = warn;
  document.getElementById('d-ok').textContent   = ok;
  document.getElementById('d-total-order').textContent = toOrd + ' poz.';
  document.getElementById('badge-dashboard').textContent = crit + ' kryt.';

  // Kartony table
  const sorted_k = [...kartRows].sort((a,b) => {
    const ord = {crit:0, warn:1, ok:2, na:3};
    return (ord[a.status]||3) - (ord[b.status]||3);
  });
  document.getElementById('d-kart-count').textContent = kartRows.length + ' pozycji';
  document.getElementById('d-kart-body').innerHTML = sorted_k.map(r => `
    <tr>
      <td style="max-width:220px;font-size:11px">${r.nazwa}</td>
      ${MAGS.map(m => `<td class="num">${magVal(r.stockByMag, m)}</td>`).join('')}
      <td class="num"><span class="num-big">${fmtN(r.stock)}</span></td>
      <td class="num"><span class="num-muted">${fmtN(r.bufferNeed)}</span></td>
      <td class="num">${r.toOrder > 0 ? `<span class="num-order">${fmtN(r.toOrder)}</span>` : '<span class="num-muted">‚Äî</span>'}</td>
      <td>${statusBadge(r.status)}</td>
    </tr>`).join('');

  // Etykiety table
  const sorted_e = [...etRows].sort((a,b) => {
    const ord = {crit:0, warn:1, ok:2, na:3};
    return (ord[a.status]||3) - (ord[b.status]||3);
  });
  document.getElementById('d-et-count').textContent = etRows.length + ' pozycji';
  document.getElementById('d-et-body').innerHTML = sorted_e.map(r => `
    <tr>
      <td style="max-width:220px;font-size:11px">${r.nazwa}</td>
      ${MAGS.map(m => `<td class="num">${magVal(r.stockByMag, m)}</td>`).join('')}
      <td class="num"><span class="num-big">${fmtN(r.stock)}</span></td>
      <td class="num"><span class="num-muted">${fmtN(r.bufferNeed)}</span></td>
      <td class="num">${r.toOrder > 0 ? `<span class="num-order">${fmtN(r.toOrder)}</span>` : '<span class="num-muted">‚Äî</span>'}</td>
      <td>${statusBadge(r.status)} ${machineTags(r.stockByMag)}</td>
    </tr>`).join('');
}

function renderKartony() {
  const magF    = document.getElementById('kart-mag').value;
  const statF   = document.getElementById('kart-status').value;
  const searchF = document.getElementById('kart-search').value.toLowerCase();

  let rows = buildRows('kartony').filter(r => {
    if (statF && r.status !== statF) return false;
    if (searchF && !r.nazwa.toLowerCase().includes(searchF)) return false;
    return true;
  }).sort((a,b) => {
    const ord = {crit:0, warn:1, ok:2, na:3};
    return (ord[a.status]||3) - (ord[b.status]||3);
  });

  document.getElementById('kart-count').textContent = rows.length + ' pozycji';
  const crit = rows.filter(r=>r.status==='crit').length;
  document.getElementById('badge-kartony').textContent = crit > 0 ? crit+' kryt.' : rows.length;

  document.getElementById('kart-body').innerHTML = rows.map(r => {
    const magHighlight = magF && r.stockByMag[magF] !== undefined;
    return `<tr${r.status==='crit'?' style="background:var(--red-bg)"':r.status==='warn'?' style="background:var(--yellow-bg)"':''}>
      <td style="max-width:200px;font-size:11px;font-weight:500">${r.nazwa}</td>
      ${MAGS.map(m => `<td class="num" ${magF===m?'style="background:rgba(250,66,17,.06);font-weight:700"':''}>${magVal(r.stockByMag, m)}</td>`).join('')}
      <td class="num"><span class="num-big">${fmtN(r.stock)}</span></td>
      <td class="num"><span class="num-muted">${fmtN(r.bufferNeed)}</span></td>
      <td class="num">${r.toOrder > 0 ? `<span class="num-order">${fmtN(r.toOrder)}</span>` : '<span class="num-muted">‚Äî</span>'}</td>
      <td>${statusBadge(r.status)}</td>
      <td>${coverBar(r.stock, r.bufferNeed)}</td>
    </tr>`;
  }).join('');
}

function renderEtykiety() {
  const magF    = document.getElementById('et-mag').value;
  const statF   = document.getElementById('et-status').value;
  const searchF = document.getElementById('et-search').value.toLowerCase();

  let rows = buildRows('etykiety').filter(r => {
    if (statF && r.status !== statF) return false;
    if (searchF && !r.nazwa.toLowerCase().includes(searchF)) return false;
    return true;
  }).sort((a,b) => {
    const ord = {crit:0, warn:1, ok:2, na:3};
    return (ord[a.status]||3) - (ord[b.status]||3);
  });

  document.getElementById('et-count').textContent = rows.length + ' pozycji';
  const crit = rows.filter(r=>r.status==='crit').length;
  document.getElementById('badge-etykiety').textContent = crit > 0 ? crit+' kryt.' : rows.length;

  document.getElementById('et-body').innerHTML = rows.map(r => `
    <tr${r.status==='crit'?' style="background:var(--red-bg)"':r.status==='warn'?' style="background:var(--yellow-bg)"':''}>
      <td style="max-width:220px;font-size:11px;font-weight:500">${r.nazwa}</td>
      ${MAGS.map(m => `<td class="num" ${magF===m?'style="background:rgba(250,66,17,.06);font-weight:700"':''}>${magVal(r.stockByMag, m)}</td>`).join('')}
      <td class="num"><span class="num-big">${fmtN(r.stock)}</span></td>
      <td class="num"><span class="num-muted">${fmtN(r.bufferNeed)}</span></td>
      <td class="num">${r.toOrder > 0 ? `<span class="num-order">${fmtN(r.toOrder)}</span>` : '<span class="num-muted">‚Äî</span>'}</td>
      <td>${machineTags(r.stockByMag)}<br>${statusBadge(r.status)}</td>
    </tr>`).join('');
}

function renderArkusz() {
  const {lead} = getParam();
  document.getElementById('ark-lead').textContent = lead + ' dni';

  const today = new Date();
  document.getElementById('ark-data').textContent = today.toLocaleDateString('pl-PL');

  // Kartony to order
  const kartRows = buildRows('kartony').filter(r => r.toOrder > 0).sort((a,b) => b.toOrder - a.toOrder);
  document.getElementById('ark-kart-body').innerHTML = kartRows.length === 0
    ? '<tr><td colspan="6" style="padding:12px;text-align:center;color:var(--green);font-size:12px">‚úì Wszystkie kartony powy≈ºej progu buforu ‚Äî brak zam√≥wie≈Ñ</td></tr>'
    : kartRows.map((r, i) => `
      <tr style="border-bottom:1px solid var(--border)">
        <td style="padding:7px 12px;border:1px solid var(--border2)">${i+1}</td>
        <td style="padding:7px 12px;border:1px solid var(--border2);font-weight:500">${r.nazwa}</td>
        <td style="padding:7px 12px;border:1px solid var(--border2);text-align:right">${fmtN(r.stock)}</td>
        <td style="padding:7px 12px;border:1px solid var(--border2);text-align:right">${fmtN(r.bufferNeed)}</td>
        <td style="padding:7px 12px;border:1px solid var(--border2);text-align:right;font-weight:700;color:var(--orange)">${fmtN(r.toOrder)}</td>
        <td style="padding:7px 12px;border:1px solid var(--border2);color:var(--text-muted);font-size:11px">${r.status === 'crit' ? '‚ö† PILNE' : ''}</td>
      </tr>`).join('');

  // Etykiety to order
  const etRows = buildRows('etykiety').filter(r => r.toOrder > 0).sort((a,b) => b.toOrder - a.toOrder);
  document.getElementById('ark-et-body').innerHTML = etRows.length === 0
    ? '<tr><td colspan="7" style="padding:12px;text-align:center;color:var(--green);font-size:12px">‚úì Wszystkie etykiety powy≈ºej progu buforu ‚Äî brak zam√≥wie≈Ñ</td></tr>'
    : etRows.map((r, i) => {
        const lobStock = r.stockByMag['≈Åob≈ºenica'] || 0;
        const restStock = MAGS.filter(m=>m!=='≈Åob≈ºenica').reduce((s,m)=>s+(r.stockByMag[m]||0),0);
        const machines = [];
        if (restStock > 0) machines.push('40mm / 300m');
        if (lobStock > 0)  machines.push('76mm / 500m (≈ÅOB)');
        return `<tr style="border-bottom:1px solid var(--border)">
          <td style="padding:7px 12px;border:1px solid var(--border2)">${i+1}</td>
          <td style="padding:7px 12px;border:1px solid var(--border2);font-weight:500;font-size:11px">${r.nazwa}</td>
          <td style="padding:7px 12px;border:1px solid var(--border2);text-align:right">${fmtN(r.stock)}</td>
          <td style="padding:7px 12px;border:1px solid var(--border2);text-align:right">${fmtN(r.bufferNeed)}</td>
          <td style="padding:7px 12px;border:1px solid var(--border2);text-align:right;font-weight:700;color:var(--orange)">${fmtN(r.toOrder)}</td>
          <td style="padding:7px 12px;border:1px solid var(--border2);font-size:10px;font-family:'DM Mono',monospace">${machines.join('<br>') || '‚Äî'}</td>
          <td style="padding:7px 12px;border:1px solid var(--border2);font-size:11px">${MAGS.filter(m=>(r.stockByMag[m]||0)>0).join(', ') || '‚Äî'}</td>
        </tr>`;
      }).join('');

  // Adresy
  const adresyData = D.adresy || {};
  document.getElementById('ark-adresy').innerHTML = Object.entries(adresyData).map(([mag, info]) => `
    <div style="background:var(--white);border:1px solid var(--border);border-radius:8px;padding:14px 16px">
      <div style="font-weight:700;font-size:13px;margin-bottom:6px">${mag} <span class="snapshot-pill" style="font-size:10px">${info.skrot}</span></div>
      <div style="font-size:11px;color:var(--text-dim);white-space:pre-line;line-height:1.7">${info.pelna}</div>
    </div>`).join('');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê TAB SWITCHING
function switchTab(name) {
  document.querySelectorAll('.tab').forEach(t => t.classList.toggle('active', t.dataset.tab === name));
  document.querySelectorAll('.tab-content').forEach(c => c.classList.toggle('active', c.id === 'tab-' + name));
  if (name === 'kartony') renderKartony();
  if (name === 'etykiety') renderEtykiety();
  if (name === 'arkusz') renderArkusz();
}

function refreshAll() {
  renderDashboard();
  if (document.getElementById('tab-kartony').classList.contains('active')) renderKartony();
  if (document.getElementById('tab-etykiety').classList.contains('active')) renderEtykiety();
  if (document.getElementById('tab-arkusz').classList.contains('active')) renderArkusz();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê INIT
// Poka≈º plan 2026 z PLAN_DATA
document.getElementById('plan-display').textContent =
  PLAN_2026_KG.toLocaleString('pl-PL', {maximumFractionDigits:0}) + ' kg';

renderDashboard();
</script>
</body>
</html>
