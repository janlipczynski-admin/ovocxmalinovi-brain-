<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Planowanie ZakupÃ³w i OpakowaÅ„ â€” OvocxMalinovi</title>
<script src="zuzycie-data.js"></script>
<script src="stany-data.js"></script>
<script src="plan-zakupow-2026-data.js"></script>
<script src="https://cdn.sheetjs.com/xlsx-0.20.3/package/dist/xlsx.full.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700&family=DM+Mono:wght@400;500&display=swap" rel="stylesheet">
<style>
:root {
  --orange:#fa4211; --purple:#9013fe; --green:#16a34a; --blue:#2563eb; --yellow:#d97706;
  --grad:linear-gradient(135deg,#fa4211,#9013fe);
  --bg:#f7f7f5; --white:#fff;
  --border:#e8e6e1; --border2:#d8d5ce;
  --text:#1a1a18; --text-dim:#6b6b65; --text-muted:#a8a8a0;
  --surface2:#f2f0eb;
  --shadow:0 1px 3px rgba(0,0,0,.06),0 1px 2px rgba(0,0,0,.04);
  --shadow-md:0 4px 16px rgba(0,0,0,.09),0 2px 4px rgba(0,0,0,.04);
  --shadow-lg:0 8px 32px rgba(0,0,0,.12),0 4px 8px rgba(0,0,0,.05);
}
*{margin:0;padding:0;box-sizing:border-box}
body{background:var(--bg);color:var(--text);font-family:'Plus Jakarta Sans',sans-serif;min-height:100vh;font-size:14px}

/* â”€â”€ Header â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
header{
  display:flex;align-items:center;justify-content:space-between;
  padding:13px 32px;background:var(--white);border-bottom:1px solid var(--border);
  position:sticky;top:0;z-index:200;box-shadow:var(--shadow);gap:12px
}
.back-btn{display:flex;align-items:center;gap:7px;text-decoration:none;color:var(--text-dim);font-size:13px;font-weight:500;transition:color .15s;white-space:nowrap}
.back-btn:hover{color:var(--orange)}
.h-center{display:flex;align-items:center;gap:8px;flex:1;justify-content:center}
.page-title{font-size:15px;font-weight:700}
.date-pill{font-family:'DM Mono',monospace;font-size:11px;color:var(--text-muted);background:var(--surface2);border:1px solid var(--border2);padding:3px 10px;border-radius:20px}

/* â”€â”€ Main â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
main{padding:28px 32px 48px;max-width:1600px;margin:0 auto}

/* Page intro */
.page-intro{margin-bottom:28px}
.page-intro h1{font-size:22px;font-weight:700;margin-bottom:4px;letter-spacing:-.3px}
.page-intro p{font-size:13px;color:var(--text-dim);line-height:1.5}

/* â”€â”€ Dashboard grid â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.dashboard-grid{
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:20px;
  align-items:start
}
@media(max-width:1100px){.dashboard-grid{grid-template-columns:repeat(2,1fr)}}
@media(max-width:700px){.dashboard-grid{grid-template-columns:1fr}}

/* â”€â”€ Cards â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.dash-card{
  background:var(--white);border:1px solid var(--border);border-radius:16px;
  overflow:hidden;display:flex;flex-direction:column;
  box-shadow:var(--shadow);transition:box-shadow .2s,transform .2s
}
.dash-card:hover{box-shadow:var(--shadow-md);transform:translateY(-2px)}

/* Color accent strip on left */
.dash-card .card-top{position:relative;padding:20px 22px 16px 26px;border-bottom:1px solid var(--border)}
.dash-card .card-top::before{content:'';position:absolute;left:0;top:0;bottom:0;width:4px;border-radius:0}
.card-orange .card-top::before{background:var(--orange)}
.card-purple .card-top::before{background:var(--purple)}
.card-blue .card-top::before{background:var(--blue)}

.card-icon-wrap{width:42px;height:42px;border-radius:11px;display:flex;align-items:center;justify-content:center;font-size:20px;margin-bottom:12px;flex-shrink:0}
.icon-orange{background:rgba(250,66,17,.1)}
.icon-purple{background:rgba(144,19,254,.1)}
.icon-blue{background:rgba(37,99,235,.1)}

.card-title{font-size:16px;font-weight:700;margin-bottom:3px;letter-spacing:-.2px}
.card-desc{font-size:12px;color:var(--text-dim);line-height:1.4;margin-bottom:10px}

.card-badge{
  display:inline-flex;align-items:center;gap:4px;
  font-family:'DM Mono',monospace;font-size:10px;
  padding:3px 9px;border-radius:20px;border:1px solid
}
.badge-active{background:rgba(250,66,17,.07);color:var(--orange);border-color:rgba(250,66,17,.2)}
.badge-purple{background:rgba(144,19,254,.07);color:var(--purple);border-color:rgba(144,19,254,.2)}
.badge-locked{background:rgba(22,163,74,.07);color:var(--green);border-color:rgba(22,163,74,.25)}
.badge-pending{background:var(--surface2);color:var(--text-muted);border-color:var(--border2)}

/* Card body */
.card-body{padding:18px 22px;flex:1}

/* Card footer */
.card-footer{
  padding:12px 22px;border-top:1px solid var(--border);
  background:var(--surface2);display:flex;gap:8px;flex-wrap:wrap;align-items:center
}

/* â”€â”€ Buttons â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.btn{
  display:inline-flex;align-items:center;gap:5px;
  padding:7px 14px;border-radius:8px;font-size:12px;
  font-family:'Plus Jakarta Sans',sans-serif;cursor:pointer;
  transition:all .15s;border:1px solid var(--border2);
  background:var(--white);color:var(--text-dim);font-weight:500;
  text-decoration:none;white-space:nowrap
}
.btn:hover{background:var(--surface2)}
.btn-orange{background:rgba(250,66,17,.07);color:var(--orange);border-color:rgba(250,66,17,.2)}
.btn-orange:hover{background:rgba(250,66,17,.12)}
.btn-purple{background:rgba(144,19,254,.07);color:var(--purple);border-color:rgba(144,19,254,.2)}
.btn-purple:hover{background:rgba(144,19,254,.12)}
.btn-blue{background:rgba(37,99,235,.07);color:var(--blue);border-color:rgba(37,99,235,.2)}
.btn-blue:hover{background:rgba(37,99,235,.12)}
.btn-sm{padding:5px 10px;font-size:11px}

/* â”€â”€ Sub-nav items â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.sub-nav-item{
  display:flex;align-items:center;justify-content:space-between;
  padding:13px 14px;border:1px solid var(--border);border-radius:11px;
  margin-bottom:10px;text-decoration:none;color:var(--text);
  transition:all .2s;background:var(--white)
}
.sub-nav-item:hover{border-color:var(--border2);box-shadow:var(--shadow-md);transform:translateY(-1px)}
.sub-nav-item:last-child{margin-bottom:0}
.sub-nav-item.disabled{opacity:.5;pointer-events:none;cursor:default}

.sub-nav-left{display:flex;align-items:center;gap:11px}
.sub-nav-icon{width:38px;height:38px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:17px;flex-shrink:0}
.sni-purple{background:rgba(144,19,254,.1)}
.sni-muted{background:var(--surface2)}
.sni-orange{background:rgba(250,66,17,.1)}
.sni-blue{background:rgba(37,99,235,.1)}

.sub-nav-title{font-size:13px;font-weight:600;margin-bottom:2px}
.sub-nav-meta{font-size:11px;color:var(--text-muted)}

.sub-nav-right{display:flex;align-items:center;gap:8px;flex-shrink:0}
.sub-nav-arrow{font-size:16px;color:var(--text-muted)}

/* â”€â”€ Stan Magazynowy â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.stan-filters{display:flex;gap:8px;margin-bottom:12px;flex-wrap:wrap;align-items:flex-end}
.stan-select{padding:5px 9px;border:1px solid var(--border2);border-radius:7px;font-size:12px;font-family:'Plus Jakarta Sans',sans-serif;color:var(--text);background:var(--white);cursor:pointer;outline:none;transition:border-color .15s}
.stan-select:focus{border-color:var(--orange)}
.stan-source-badge{font-family:'DM Mono',monospace;font-size:10px;padding:2px 8px;border-radius:10px;border:1px solid}
.source-preset{background:rgba(22,163,74,.07);color:var(--green);border-color:rgba(22,163,74,.25)}
.source-upload{background:rgba(250,66,17,.07);color:var(--orange);border-color:rgba(250,66,17,.2)}

/* Stats mini row */
.stats-mini{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin-bottom:12px}
.stat-mini{background:var(--surface2);border-radius:8px;padding:9px 11px;border:1px solid var(--border)}
.stat-mini-label{font-size:10px;color:var(--text-muted);text-transform:uppercase;letter-spacing:.05em;font-family:'DM Mono',monospace;margin-bottom:3px}
.stat-mini-val{font-size:17px;font-weight:700;font-variant-numeric:tabular-nums;line-height:1}

/* Table */
.stan-table-wrap{overflow-x:auto;max-height:300px;overflow-y:auto;border:1px solid var(--border);border-radius:9px}
.stan-table{width:100%;border-collapse:collapse;font-size:12px}
.stan-table th{background:var(--surface2);color:var(--text-dim);font-size:10px;font-weight:600;text-transform:uppercase;letter-spacing:.05em;padding:7px 10px;text-align:left;position:sticky;top:0;border-bottom:1px solid var(--border);white-space:nowrap;cursor:pointer;user-select:none}
.stan-table th:hover{background:#e9e7e2}
.stan-table th.sort-asc::after{content:' â†‘';color:var(--orange)}
.stan-table th.sort-desc::after{content:' â†“';color:var(--orange)}
.stan-table td{padding:6px 10px;border-bottom:1px solid var(--border);white-space:nowrap;max-width:220px;overflow:hidden;text-overflow:ellipsis}
.stan-table tr:last-child td{border-bottom:none}
.stan-table tr:hover td{background:rgba(250,66,17,.03)}
.num-cell{font-family:'DM Mono',monospace;text-align:right}
.stan-table-footer{padding:6px 12px;background:var(--surface2);border-top:1px solid var(--border);font-size:11px;color:var(--text-muted);font-family:'DM Mono',monospace;border-radius:0 0 9px 9px}

/* Upload zone (secondary) */
.upload-zone-mini{border:1.5px dashed var(--border2);border-radius:8px;padding:10px 14px;cursor:pointer;transition:all .15s;background:var(--surface2);display:flex;align-items:center;gap:8px;margin-top:10px;font-size:12px;color:var(--text-dim)}
.upload-zone-mini:hover{border-color:var(--orange);color:var(--orange);background:rgba(250,66,17,.04)}
input[type=file]#mag-file{display:none}

/* â”€â”€ ZuÅ¼ycie â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.zuz-stats{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin-bottom:18px}
.zuz-stat{background:var(--surface2);border-radius:8px;padding:10px 12px;border:1px solid var(--border);text-align:center}
.zuz-stat-label{font-size:10px;color:var(--text-muted);text-transform:uppercase;letter-spacing:.05em;font-family:'DM Mono',monospace;margin-bottom:4px}
.zuz-stat-val{font-size:18px;font-weight:700;font-variant-numeric:tabular-nums}

/* â”€â”€ Planowanie placeholder â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.wip-box{
  border:1.5px dashed var(--border2);border-radius:11px;
  padding:22px 18px;text-align:center;background:var(--surface2);
  margin-bottom:18px
}
.wip-icon{font-size:30px;margin-bottom:8px;opacity:.7}
.wip-title{font-size:13px;font-weight:600;margin-bottom:4px}
.wip-text{font-size:11px;color:var(--text-muted);line-height:1.6}

.section-label{font-size:10px;font-weight:700;text-transform:uppercase;letter-spacing:.07em;color:var(--text-muted);margin-bottom:10px;font-family:'DM Mono',monospace}
</style>
</head>
<body>

<header>
  <a href="index.html" class="back-btn">
    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M19 12H5M12 19l-7-7 7-7"/></svg>
    Centrum Operacyjne
  </a>
  <div class="h-center">
    <span class="page-title">Planowanie ZakupÃ³w i OpakowaÅ„</span>
  </div>
  <div class="date-pill" id="today-date"></div>
</header>

<main>
  <div class="page-intro">
    <h1>Dashboard zakupowy</h1>
    <p>ZarzÄ…dzaj stanami magazynowymi, analizuj zuÅ¼ycie materiaÅ‚Ã³w i planuj zakupy opakowaÅ„.</p>
  </div>

  <div class="dashboard-grid">

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         KARTA 1 â€” Stan Magazynowy
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div class="dash-card card-orange">

      <div class="card-top">
        <div class="card-icon-wrap icon-orange">ğŸ“¦</div>
        <div class="card-title"><a href="zakupy-stan.html" style="color:inherit;text-decoration:none">Stan Magazynowy â€º</a></div>
        <div class="card-desc">Stany opakowaÅ„ w magazynach na wybrany dzieÅ„ â€” wgraj plik z exportu StreamSoft</div>
        <div class="card-badge badge-active" id="stan-badge">Brak danych</div>
      </div>

      <div class="card-body">

        <!-- â”€â”€â”€ Filtry â”€â”€â”€ -->
        <div class="stan-filters">
          <select class="stan-select" id="stan-f-mag" onchange="renderStan()">
            <option value="">Wszystkie magazyny</option>
          </select>
          <select class="stan-select" id="stan-f-grp" onchange="renderStan()">
            <option value="">Wszystkie grupy</option>
          </select>
          <span class="stan-source-badge source-preset" id="stan-source-lbl">ğŸ“… 25.02.2026</span>
        </div>

        <!-- â”€â”€â”€ Stats â”€â”€â”€ -->
        <div class="stats-mini" id="stan-stats"></div>

        <!-- â”€â”€â”€ Tabela â”€â”€â”€ -->
        <div class="stan-table-wrap">
          <table class="stan-table">
            <thead>
              <tr>
                <th onclick="stanSort('nazwa')">Nazwa</th>
                <th onclick="stanSort('magazyn')">Magazyn</th>
                <th onclick="stanSort('nazwa_grupy')">Grupa</th>
                <th onclick="stanSort('stan')" style="text-align:right">Stan</th>
                <th onclick="stanSort('jm')">Jm</th>
              </tr>
            </thead>
            <tbody id="stan-tbody"></tbody>
          </table>
        </div>
        <div class="stan-table-footer" id="stan-footer"></div>

        <!-- â”€â”€â”€ Upload nowego pliku (secondary) â”€â”€â”€ -->
        <div class="upload-zone-mini" onclick="document.getElementById('mag-file').click()"
             ondrop="handleDrop(event)" ondragover="event.preventDefault()" ondragleave="event.preventDefault()">
          <span>ğŸ“‚</span>
          <span id="upload-mini-lbl">Wgraj nowszy plik XLSX ze StreamSoft</span>
        </div>
        <input type="file" id="mag-file" accept=".xlsx,.xls" onchange="handleFile(event)">

      </div>

      <div class="card-footer">
        <span id="stan-custom-clear" style="display:none">
          <button class="btn btn-sm" onclick="clearCustomStan()">âœ• UsuÅ„ wÅ‚asny plik</button>
        </span>
        <span style="flex:1"></span>
        <span style="font-size:11px;color:var(--text-muted);font-family:'DM Mono',monospace" id="stan-total-lbl"></span>
        <a href="zakupy-stan.html" class="btn btn-orange">â†’ PeÅ‚ny widok</a>
      </div>
    </div>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         KARTA 2 â€” ZuÅ¼ycie MateriaÅ‚Ã³w
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div class="dash-card card-purple">

      <div class="card-top">
        <div class="card-icon-wrap icon-purple">ğŸ“Š</div>
        <div class="card-title">ZuÅ¼ycie MateriaÅ‚Ã³w</div>
        <div class="card-desc">Analiza zuÅ¼ycia opakowaÅ„ per magazyn i materiaÅ‚ â€” dane historyczne i bieÅ¼Ä…ce</div>
        <div class="card-badge badge-purple" id="zuz-badge">Åadowanieâ€¦</div>
      </div>

      <div class="card-body">
        <div class="zuz-stats">
          <div class="zuz-stat">
            <div class="zuz-stat-label">Rekordy 2025</div>
            <div class="zuz-stat-val" id="zuz-cnt" style="color:var(--purple)">â€”</div>
          </div>
          <div class="zuz-stat">
            <div class="zuz-stat-label">Magazyny</div>
            <div class="zuz-stat-val" id="zuz-mag">â€”</div>
          </div>
          <div class="zuz-stat">
            <div class="zuz-stat-label">Typy mat.</div>
            <div class="zuz-stat-val" id="zuz-typy">â€”</div>
          </div>
        </div>

        <div class="section-label">Wybierz rok</div>

        <a href="zuzycie-2025.html" class="sub-nav-item">
          <div class="sub-nav-left">
            <div class="sub-nav-icon sni-purple">ğŸ“</div>
            <div>
              <div class="sub-nav-title">ZuÅ¼ycie 2025</div>
              <div class="sub-nav-meta" id="zuz-meta-2025">IVâ€“XI 2025 Â· Å‚adowanieâ€¦</div>
            </div>
          </div>
          <div class="sub-nav-right">
            <span class="card-badge badge-locked">ğŸ”’ Historyczne</span>
            <span class="sub-nav-arrow">â€º</span>
          </div>
        </a>

        <a href="#" class="sub-nav-item disabled">
          <div class="sub-nav-left">
            <div class="sub-nav-icon sni-muted">ğŸ“</div>
            <div>
              <div class="sub-nav-title">ZuÅ¼ycie 2026</div>
              <div class="sub-nav-meta">Dane bÄ™dÄ… uzupeÅ‚niane na bieÅ¼Ä…co</div>
            </div>
          </div>
          <div class="sub-nav-right">
            <span class="card-badge badge-pending">W przygotowaniu</span>
            <span class="sub-nav-arrow" style="opacity:.4">â€º</span>
          </div>
        </a>
      </div>

      <div class="card-footer">
        <a href="zuzycie-2025.html" class="btn btn-purple">ğŸ“Š OtwÃ³rz ZuÅ¼ycie 2025</a>
      </div>
    </div>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         KARTA 3 â€” Planowanie ZakupÃ³w
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div class="dash-card card-blue">

      <div class="card-top">
        <div class="card-icon-wrap icon-blue">ğŸ›’</div>
        <div class="card-title"><a href="zakupy-plan2026.html" style="color:inherit;text-decoration:none">Planowanie ZakupÃ³w â€º</a></div>
        <div class="card-desc">Plan kartonÃ³w na sezon 2026 â€” proporcje 2025 Ã— wolumen 2026 per klient/owoc</div>
        <div class="card-badge badge-active" id="plan-badge">Plan 2026</div>
      </div>

      <div class="card-body">

        <!-- Plan 2026 mini-stats -->
        <div class="stats-mini" id="plan-mini-stats" style="margin-bottom:14px">
          <div class="stat-mini"><div class="stat-mini-label">Kart. plan 2026</div><div class="stat-mini-val" id="p26-kart" style="color:var(--blue)">â€”</div></div>
          <div class="stat-mini"><div class="stat-mini-label">KlientÃ³w z planem</div><div class="stat-mini-val" id="p26-kl">â€”</div></div>
          <div class="stat-mini"><div class="stat-mini-label">Baza (kart. 2025)</div><div class="stat-mini-val" id="p26-hist" style="font-size:13px;color:var(--text-dim)">â€”</div></div>
        </div>

        <div class="section-label">PodzakÅ‚adki</div>

        <a href="zakupy-plan2026.html" class="sub-nav-item">
          <div class="sub-nav-left">
            <div class="sub-nav-icon sni-blue">ğŸ“‹</div>
            <div>
              <div class="sub-nav-title">Plan sprzedaÅ¼y na 2026</div>
              <div class="sub-nav-meta">Total Â· OGL Â· Jeronimo Â· Pozostali</div>
            </div>
          </div>
          <div class="sub-nav-right">
            <span class="card-badge badge-active">Aktywny</span>
            <span class="sub-nav-arrow">â€º</span>
          </div>
        </a>

        <a href="zakupy-klienci.html" class="sub-nav-item">
          <div class="sub-nav-left">
            <div class="sub-nav-icon sni-orange">ğŸ“¦</div>
            <div>
              <div class="sub-nav-title">Konfekcja per klient</div>
              <div class="sub-nav-meta">Zestawienie opakowaÅ„ wg klientÃ³w 2025</div>
            </div>
          </div>
          <span class="sub-nav-arrow">â€º</span>
        </a>

        <a href="zakupy-harmonogram.html" class="sub-nav-item">
          <div class="sub-nav-left">
            <div class="sub-nav-icon sni-orange">ğŸ“…</div>
            <div>
              <div class="sub-nav-title">Harmonogram zakupÃ³w</div>
              <div class="sub-nav-meta">Terminy i planowane zamÃ³wienia</div>
            </div>
          </div>
          <span class="sub-nav-arrow">â€º</span>
        </a>
      </div>

      <div class="card-footer">
        <a href="zakupy-plan2026.html" class="btn btn-orange">â†’ Plan ZakupÃ³w 2026</a>
        <span style="flex:1"></span>
        <a href="https://github.com/janlipczynski-admin/ovocxmalinovi-brain-/commits/main/planowanie-data.js"
           target="_blank" class="btn btn-sm" style="font-size:10px">ğŸ• Historia zmian</a>
      </div>
    </div>

  </div><!-- /dashboard-grid -->
</main>

<script>
// â”€â”€ Date display â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const today = new Date();
document.getElementById('today-date').textContent =
  today.toLocaleDateString('pl-PL',{day:'2-digit',month:'2-digit',year:'numeric'});

// â”€â”€ ZuÅ¼ycie stats (from zuzycie-data.js) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
if (window.ZUZYCIE_DATA) {
  const rek = window.ZUZYCIE_DATA.rekordy;
  const mags  = new Set(rek.map(r => r.magazyn));
  const typy  = new Set(rek.map(r => r.typ_materialu));
  const mats  = new Set(rek.map(r => r.surowiec_nazwa));
  document.getElementById('zuz-cnt').textContent   = rek.length.toLocaleString('pl-PL');
  document.getElementById('zuz-mag').textContent   = mags.size;
  document.getElementById('zuz-typy').textContent  = typy.size;
  document.getElementById('zuz-badge').textContent = rek.length + ' rekordÃ³w Â· 2025';
  document.getElementById('zuz-meta-2025').textContent =
    window.ZUZYCIE_DATA.zakres + ' Â· ' + rek.length + ' rekordÃ³w Â· ' + mats.size + ' materiaÅ‚Ã³w';
}

// â”€â”€ Stan Magazynowy â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const LS_KEY = 'oxm_stan_custom_v1';

// Aktywny dataset â€” domyÅ›lnie preloaded, moÅ¼liwy override z localStorage
let stanData    = null;  // array of records
let stanDate    = '';
let stanSortCol = 'stan';
let stanSortDir = -1;    // descending by default (highest stock first)

function stanInit() {
  // Check if user uploaded custom file
  try {
    const raw = localStorage.getItem(LS_KEY);
    if (raw) {
      const custom = JSON.parse(raw);
      stanData = custom.rekordy;
      stanDate = custom.date;
      document.getElementById('stan-source-lbl').textContent = 'ğŸ“‚ ' + custom.date + ' (wÅ‚asny plik)';
      document.getElementById('stan-source-lbl').className = 'stan-source-badge source-upload';
      document.getElementById('stan-custom-clear').style.display = 'inline';
      document.getElementById('upload-mini-lbl').textContent = 'â†º ZastÄ…p plik nowszym z StreamSoft';
    }
  } catch(e){}

  // Fallback to preloaded data
  if (!stanData && window.STANY_DATA) {
    stanData = window.STANY_DATA.rekordy;
    stanDate = window.STANY_DATA.data;
  }

  if (!stanData) return;

  // Populate filter dropdowns
  const mags = [...new Set(stanData.map(r => r.magazyn))].sort((a,b) => a.localeCompare(b,'pl'));
  const grps = [...new Set(stanData.map(r => r.nazwa_grupy))].sort((a,b) => a.localeCompare(b,'pl'));
  const selMag = document.getElementById('stan-f-mag');
  const selGrp = document.getElementById('stan-f-grp');
  mags.forEach(m => { const o = new Option(m,m); selMag.appendChild(o); });
  grps.forEach(g => { const o = new Option(g,g); selGrp.appendChild(o); });

  document.getElementById('stan-badge').textContent = 'Stan: ' + stanDate;
  renderStan();
}

function stanSort(col) {
  stanSortDir = stanSortCol === col ? stanSortDir * -1 : (col === 'stan' ? -1 : 1);
  stanSortCol = col;
  document.querySelectorAll('.stan-table th').forEach(th => {
    th.classList.remove('sort-asc','sort-desc');
    if (th.getAttribute('onclick') === `stanSort('${col}')`)
      th.classList.add(stanSortDir === 1 ? 'sort-asc' : 'sort-desc');
  });
  renderStan();
}

function renderStan() {
  if (!stanData) return;
  const mag = document.getElementById('stan-f-mag').value;
  const grp = document.getElementById('stan-f-grp').value;

  let rows = stanData.filter(r =>
    (!mag || r.magazyn === mag) &&
    (!grp || r.nazwa_grupy === grp)
  );

  rows.sort((a,b) => {
    const av = a[stanSortCol], bv = b[stanSortCol];
    if (av == null && bv == null) return 0;
    if (av == null) return 1; if (bv == null) return -1;
    return (typeof av === 'string' ? av.localeCompare(bv,'pl') : av - bv) * stanSortDir;
  });

  const totalStan = rows.reduce((s,r) => s + (r.stan||0), 0);
  const mags      = new Set(rows.map(r => r.magazyn)).size;

  document.getElementById('stan-stats').innerHTML = `
    <div class="stat-mini"><div class="stat-mini-label">RekordÃ³w</div><div class="stat-mini-val" style="color:var(--orange)">${rows.length}</div></div>
    <div class="stat-mini"><div class="stat-mini-label">Magazyny</div><div class="stat-mini-val">${mags}</div></div>
    <div class="stat-mini"><div class="stat-mini-label">ÅÄ…cznie szt.</div><div class="stat-mini-val" style="font-size:13px">${totalStan.toLocaleString('pl-PL',{maximumFractionDigits:0})}</div></div>
  `;

  document.getElementById('stan-total-lbl').textContent =
    'ÅÄ…cznie: ' + totalStan.toLocaleString('pl-PL',{maximumFractionDigits:0}) + ' szt.';

  const GRP_CLR = {
    'Etykiety':'var(--purple)',
    'Opakowania-Transportowe':'var(--orange)',
    'Opakowania-Jednostkowe':'var(--blue)',
    'Opakowania-Zbiorcze':'var(--green)',
    'Opakowania-WkÅ‚adki absorpcyjne':'var(--yellow)'
  };

  document.getElementById('stan-tbody').innerHTML = rows.map(r => {
    const clr = GRP_CLR[r.nazwa_grupy] || 'var(--text-dim)';
    return `<tr>
      <td title="${r.nazwa}" style="font-weight:500;max-width:200px;overflow:hidden;text-overflow:ellipsis">${r.nazwa||r.indeks||'â€”'}</td>
      <td style="font-size:11px">${r.magazyn}</td>
      <td><span style="font-size:10px;font-weight:700;color:${clr}">${r.nazwa_grupy||'â€”'}</span></td>
      <td class="num-cell" style="font-weight:700">${(r.stan||0).toLocaleString('pl-PL',{maximumFractionDigits:0})}</td>
      <td style="font-size:11px;color:var(--text-muted)">${r.jm||''}</td>
    </tr>`;
  }).join('') || '<tr><td colspan="5" style="text-align:center;padding:24px;color:var(--text-muted)">Brak wynikÃ³w</td></tr>';

  document.getElementById('stan-footer').textContent =
    'WyÅ›wietlono ' + rows.length + ' z ' + stanData.length + ' rekordÃ³w Â· stan na ' + stanDate;
}

// â”€â”€ Upload nowego pliku â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function handleDrop(e) {
  e.preventDefault();
  const file = e.dataTransfer.files[0];
  if (file) processFile(file);
}
function handleFile(e) {
  const file = e.target.files[0];
  if (file) processFile(file);
}

function processFile(file) {
  const reader = new FileReader();
  reader.onload = function(ev) {
    try {
      const wb = XLSX.read(ev.target.result, { type:'array' });
      const allSheets = wb.SheetNames;
      const rekordy = [];
      const m = file.name.match(/(\d{1,2}[.\-\/]\d{1,2}[.\-\/]\d{4})/);
      const dateStr = m ? m[1].replace(/[-\/]/g,'.') : file.name.replace(/\.xlsx?$/i,'');

      allSheets.forEach(sname => {
        const ws  = wb.Sheets[sname];
        const raw = XLSX.utils.sheet_to_json(ws, { header:1, defval:'' });
        if (raw.length < 2) return;
        const headers = raw[0].map(String);
        const idxNazwa = headers.findIndex(h => h.toLowerCase().includes('nazwa'));
        const idxStan  = headers.findIndex(h => h.toLowerCase() === 'stan');
        const idxJm    = headers.findIndex(h => h.toLowerCase() === 'jm');
        const idxGrp   = headers.findIndex(h => h.toLowerCase().includes('nazwa grupy') || h.toLowerCase().includes('nazwa_grupy'));
        const idxKGrp  = headers.findIndex(h => h.toLowerCase().includes('kod grupy') || h.toLowerCase().includes('kod_grupy'));
        const idxWart  = headers.findIndex(h => h.toLowerCase().includes('wartoÅ›Ä‡ zakupu') || h.toLowerCase().includes('wartosc'));

        raw.slice(1).forEach(row => {
          if (!row.some(c => c !== '')) return;
          rekordy.push({
            indeks:      String(row[0]||'').trim(),
            nazwa:       String(row[idxNazwa >= 0 ? idxNazwa : 2]||'').trim(),
            stan:        typeof row[idxStan >= 0 ? idxStan : 3] === 'number' ? row[idxStan >= 0 ? idxStan : 3] : 0,
            jm:          String(row[idxJm >= 0 ? idxJm : 10]||'szt.').trim(),
            wartosc:     typeof row[idxWart >= 0 ? idxWart : 4] === 'number' ? Math.round(row[idxWart >= 0 ? idxWart : 4]*100)/100 : 0,
            kod_grupy:   String(row[idxKGrp >= 0 ? idxKGrp : 12]||'').trim(),
            nazwa_grupy: String(row[idxGrp >= 0 ? idxGrp : 13]||'').trim(),
            magazyn:     sname.trim()
          });
        });
      });

      if (!rekordy.length) { alert('Nie znaleziono danych w pliku.'); return; }

      try { localStorage.setItem(LS_KEY, JSON.stringify({ date:dateStr, rekordy })); } catch(e){}
      stanData = rekordy;
      stanDate = dateStr;

      document.getElementById('stan-source-lbl').textContent = 'ğŸ“‚ ' + dateStr + ' (wÅ‚asny plik)';
      document.getElementById('stan-source-lbl').className = 'stan-source-badge source-upload';
      document.getElementById('stan-badge').textContent = 'Stan: ' + dateStr;
      document.getElementById('stan-custom-clear').style.display = 'inline';
      document.getElementById('upload-mini-lbl').textContent = 'â†º ZastÄ…p plik nowszym z StreamSoft';

      // Rebuild dropdowns
      const selMag = document.getElementById('stan-f-mag');
      const selGrp = document.getElementById('stan-f-grp');
      selMag.innerHTML = '<option value="">Wszystkie magazyny</option>';
      selGrp.innerHTML = '<option value="">Wszystkie grupy</option>';
      [...new Set(rekordy.map(r => r.magazyn))].sort((a,b)=>a.localeCompare(b,'pl')).forEach(m => selMag.appendChild(new Option(m,m)));
      [...new Set(rekordy.map(r => r.nazwa_grupy).filter(Boolean))].sort((a,b)=>a.localeCompare(b,'pl')).forEach(g => selGrp.appendChild(new Option(g,g)));

      renderStan();
    } catch(err) {
      alert('BÅ‚Ä…d wczytywania pliku:\n' + err.message);
    }
  };
  reader.readAsArrayBuffer(file);
}

function clearCustomStan() {
  localStorage.removeItem(LS_KEY);
  stanData = null; stanDate = '';
  document.getElementById('stan-custom-clear').style.display = 'none';
  document.getElementById('stan-source-lbl').textContent = 'ğŸ“… 25.02.2026';
  document.getElementById('stan-source-lbl').className = 'stan-source-badge source-preset';
  document.getElementById('upload-mini-lbl').textContent = 'Wgraj nowszy plik XLSX ze StreamSoft';
  document.getElementById('mag-file').value = '';
  const selMag = document.getElementById('stan-f-mag');
  const selGrp = document.getElementById('stan-f-grp');
  selMag.innerHTML = '<option value="">Wszystkie magazyny</option>';
  selGrp.innerHTML = '<option value="">Wszystkie grupy</option>';
  stanInit();
}

stanInit();

// â”€â”€ Plan 2026 mini-stats â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
(function() {
  if (!window.PLAN2026_DATA) return;
  const { totals, rows } = window.PLAN2026_DATA;
  const kliZPlanem = new Set(rows.filter(r=>r.kartony_2026).map(r=>r.klient)).size;
  const fmt = n => n == null ? 'â€”' : Math.round(n).toLocaleString('pl-PL');
  document.getElementById('p26-kart').textContent = fmt(totals.kartony_2026);
  document.getElementById('p26-kl').textContent   = kliZPlanem + ' / ' + new Set(rows.map(r=>r.klient)).size;
  document.getElementById('p26-hist').textContent = fmt(totals.kartony_2025);
  document.getElementById('plan-badge').textContent = 'Plan 2026 Â· aktywny';
})();
</script>
</body>
</html>
