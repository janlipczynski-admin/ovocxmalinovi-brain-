<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Zakupy OpakowaÅ„ â€” OvocxMalinovi</title>
<script src="zuzycie-data.js"></script>
<script src="stany-data.js"></script>
<script src="plan-zakupow-2026-data.js"></script>
<script src="https://cdn.sheetjs.com/xlsx-0.20.3/package/dist/xlsx.full.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&family=DM+Mono:wght@400;500&display=swap" rel="stylesheet">
<style>
:root {
  --orange:#fa4211; --purple:#9013fe; --green:#16a34a; --blue:#2563eb; --yellow:#d97706;
  --grad:linear-gradient(135deg,#fa4211,#9013fe);
  --bg:#f4f3f0; --white:#fff;
  --border:#e8e6e1; --border2:#d8d5ce;
  --text:#1a1a18; --text-dim:#6b6b65; --text-muted:#a8a8a0;
  --surface2:#f2f0eb;
  --shadow:0 1px 3px rgba(0,0,0,.06),0 1px 2px rgba(0,0,0,.04);
  --shadow-md:0 4px 16px rgba(0,0,0,.09),0 2px 4px rgba(0,0,0,.04);
}
*{margin:0;padding:0;box-sizing:border-box}
body{background:var(--bg);color:var(--text);font-family:'Plus Jakarta Sans',sans-serif;min-height:100vh;font-size:14px}

/* â”€â”€ Header â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
header{display:flex;align-items:center;justify-content:space-between;padding:13px 32px;background:var(--white);border-bottom:1px solid var(--border);position:sticky;top:0;z-index:200;box-shadow:var(--shadow);gap:12px}
.back-btn{display:flex;align-items:center;gap:7px;text-decoration:none;color:var(--text-dim);font-size:13px;font-weight:500;transition:color .15s;white-space:nowrap}
.back-btn:hover{color:var(--orange)}
.h-center{display:flex;align-items:center;gap:8px;flex:1;justify-content:center}
.page-title{font-size:15px;font-weight:700}
.date-pill{font-family:'DM Mono',monospace;font-size:11px;color:var(--text-muted);background:var(--surface2);border:1px solid var(--border2);padding:3px 10px;border-radius:20px;white-space:nowrap}

/* â”€â”€ Main â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
main{padding:24px 32px 56px;max-width:1600px;margin:0 auto}

/* â”€â”€ Page intro â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.page-intro{display:flex;align-items:center;gap:20px;margin-bottom:20px;padding:18px 22px;background:var(--white);border:1px solid var(--border);border-radius:16px;box-shadow:var(--shadow)}
.page-intro img{height:42px;flex-shrink:0}
.page-intro-divider{width:1px;height:34px;background:var(--border2);flex-shrink:0}
.page-intro-text h1{font-size:19px;font-weight:800;letter-spacing:-.3px;margin-bottom:2px}
.page-intro-text p{font-size:12px;color:var(--text-dim);line-height:1.5}
.page-intro-stats{display:flex;gap:20px;margin-left:auto;flex-shrink:0}
.pi-stat{text-align:center}
.pi-stat-val{font-size:18px;font-weight:800;font-family:'DM Mono',monospace;line-height:1}
.pi-stat-lbl{font-size:10px;color:var(--text-muted);text-transform:uppercase;letter-spacing:.05em;margin-top:2px}

/* â”€â”€ Stan Magazynowy â€” top widget â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.stan-widget{background:var(--white);border:1px solid var(--border);border-radius:16px;margin-bottom:20px;overflow:hidden;box-shadow:var(--shadow);transition:box-shadow .2s;position:relative}
.stan-widget::before{content:'';position:absolute;left:0;top:0;bottom:0;width:4px;background:var(--orange);border-radius:0}
.stan-widget:hover{box-shadow:var(--shadow-md)}

.stan-widget-header{display:flex;align-items:center;gap:12px;padding:14px 20px 14px 22px;border-bottom:1px solid var(--border);flex-wrap:wrap}
.sw-icon{width:38px;height:38px;border-radius:10px;background:rgba(250,66,17,.1);display:flex;align-items:center;justify-content:center;font-size:17px;flex-shrink:0}
.sw-title-group{min-width:0}
.sw-title{font-size:14px;font-weight:700;letter-spacing:-.15px}
.sw-desc{font-size:11px;color:var(--text-muted);margin-top:1px}
.sw-filters{display:flex;align-items:center;gap:8px;margin-left:auto;flex-wrap:wrap}
.sw-stats{display:flex;gap:8px;flex-shrink:0}
.sw-stat{background:var(--surface2);border-radius:7px;padding:7px 11px;border:1px solid var(--border);text-align:center;min-width:76px}
.sw-stat-label{font-size:9px;color:var(--text-muted);text-transform:uppercase;letter-spacing:.05em;font-family:'DM Mono',monospace;margin-bottom:3px}
.sw-stat-val{font-size:15px;font-weight:700;font-variant-numeric:tabular-nums;line-height:1}

.stan-widget-body{padding:0}
.stan-widget-footer{padding:10px 20px;border-top:1px solid var(--border);background:var(--surface2);display:flex;gap:8px;align-items:center;flex-wrap:wrap}

/* â”€â”€ Stan table â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.stan-select{padding:5px 9px;border:1px solid var(--border2);border-radius:7px;font-size:12px;font-family:'Plus Jakarta Sans',sans-serif;color:var(--text);background:var(--white);cursor:pointer;outline:none;transition:border-color .15s}
.stan-select:focus{border-color:var(--orange)}
.stan-source-badge{font-family:'DM Mono',monospace;font-size:10px;padding:2px 8px;border-radius:10px;border:1px solid}
.source-preset{background:rgba(22,163,74,.07);color:var(--green);border-color:rgba(22,163,74,.25)}
.source-upload{background:rgba(250,66,17,.07);color:var(--orange);border-color:rgba(250,66,17,.2)}

.stan-table-wrap{overflow-x:auto;max-height:300px;overflow-y:auto}
.stan-table{width:100%;border-collapse:collapse;font-size:12px}
.stan-table th{background:var(--surface2);color:var(--text-dim);font-size:10px;font-weight:600;text-transform:uppercase;letter-spacing:.05em;padding:7px 10px;text-align:left;position:sticky;top:0;border-bottom:1px solid var(--border);white-space:nowrap;cursor:pointer;user-select:none}
.stan-table th:hover{background:#e9e7e2}
.stan-table th.sort-asc::after{content:' â†‘';color:var(--orange)}
.stan-table th.sort-desc::after{content:' â†“';color:var(--orange)}
.stan-table td{padding:6px 10px;border-bottom:1px solid var(--border);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.stan-table tr:last-child td{border-bottom:none}
.stan-table tr:hover td{background:rgba(250,66,17,.03)}
.num-cell{font-family:'DM Mono',monospace;text-align:right}
.stan-table-footer{padding:6px 12px;background:var(--surface2);border-top:1px solid var(--border);font-size:10px;color:var(--text-muted);font-family:'DM Mono',monospace}
.upload-zone-mini{border:1.5px dashed var(--border2);border-radius:8px;padding:8px 12px;cursor:pointer;transition:all .15s;background:var(--white);display:flex;align-items:center;gap:8px;font-size:11px;color:var(--text-dim);flex:1;min-width:200px}
.upload-zone-mini:hover{border-color:var(--orange);color:var(--orange);background:rgba(250,66,17,.04)}
input[type=file]#mag-file{display:none}

/* â”€â”€ Buttons â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.btn{display:inline-flex;align-items:center;gap:5px;padding:7px 14px;border-radius:8px;font-size:12px;font-family:'Plus Jakarta Sans',sans-serif;cursor:pointer;transition:all .15s;border:1px solid var(--border2);background:var(--white);color:var(--text-dim);font-weight:500;text-decoration:none;white-space:nowrap}
.btn:hover{background:var(--surface2)}
.btn-orange{background:rgba(250,66,17,.07);color:var(--orange);border-color:rgba(250,66,17,.2)}
.btn-orange:hover{background:rgba(250,66,17,.12)}
.btn-purple{background:rgba(144,19,254,.07);color:var(--purple);border-color:rgba(144,19,254,.2)}
.btn-purple:hover{background:rgba(144,19,254,.12)}
.btn-blue{background:rgba(37,99,235,.07);color:var(--blue);border-color:rgba(37,99,235,.2)}
.btn-blue:hover{background:rgba(37,99,235,.12)}
.btn-sm{padding:5px 10px;font-size:11px}

/* â”€â”€ Category Section â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.cat-section{background:var(--white);border:1px solid var(--border);border-radius:20px;margin-bottom:20px;overflow:hidden;box-shadow:var(--shadow);transition:box-shadow .2s}
.cat-section:hover{box-shadow:var(--shadow-md)}
.cat-header{display:flex;align-items:center;gap:16px;padding:18px 28px 18px 0;border-bottom:1px solid var(--border);background:var(--white);position:relative}
.cat-header::before{content:'';position:absolute;left:0;top:0;bottom:0;width:5px;border-radius:0}
.cat-orange .cat-header::before{background:var(--orange)}
.cat-blue   .cat-header::before{background:var(--blue)}
.cat-green  .cat-header::before{background:var(--green)}
.cat-purple .cat-header::before{background:var(--purple)}
.cat-icon{width:52px;height:52px;border-radius:14px;display:flex;align-items:center;justify-content:center;font-size:24px;flex-shrink:0;margin-left:20px}
.ci-orange{background:rgba(250,66,17,.10)}
.ci-blue  {background:rgba(37,99,235,.10)}
.ci-green {background:rgba(22,163,74,.10)}
.ci-purple{background:rgba(144,19,254,.10)}
.cat-info{flex:1}
.cat-title{font-size:17px;font-weight:800;letter-spacing:-.25px;margin-bottom:2px}
.cat-desc{font-size:12px;color:var(--text-dim);line-height:1.4}
.cat-badge{display:inline-flex;align-items:center;gap:4px;font-family:'DM Mono',monospace;font-size:10px;padding:4px 11px;border-radius:20px;border:1px solid;white-space:nowrap;flex-shrink:0;margin-right:24px}
.badge-active{background:rgba(22,163,74,.07);color:var(--green);border-color:rgba(22,163,74,.25)}
.badge-orange{background:rgba(250,66,17,.07);color:var(--orange);border-color:rgba(250,66,17,.2)}
.badge-pending{background:var(--surface2);color:var(--text-muted);border-color:var(--border2)}
.badge-locked{background:rgba(22,163,74,.07);color:var(--green);border-color:rgba(22,163,74,.25)}
.badge-purple{background:rgba(144,19,254,.07);color:var(--purple);border-color:rgba(144,19,254,.2)}

/* â”€â”€ Tools grid inside boxes â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.cat-body{padding:22px 24px}
.cat-tools-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:16px;align-items:start}
@media(max-width:900px){.cat-tools-grid{grid-template-columns:1fr}}

/* â”€â”€ Inner cards â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.dash-card{background:var(--white);border:1.5px solid var(--border);border-radius:14px;overflow:hidden;display:flex;flex-direction:column;box-shadow:var(--shadow);transition:box-shadow .2s,transform .2s}
.dash-card:hover{box-shadow:var(--shadow-md);transform:translateY(-2px)}
.dash-card .card-top{position:relative;padding:16px 18px 14px 20px;border-bottom:1px solid var(--border)}
.dash-card .card-top::before{content:'';position:absolute;left:0;top:0;bottom:0;width:3px;border-radius:0}
.card-purple .card-top::before{background:var(--purple)}
.card-blue   .card-top::before{background:var(--blue)}
.card-icon-wrap{width:38px;height:38px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:18px;margin-bottom:10px;flex-shrink:0}
.icon-purple{background:rgba(144,19,254,.1)}
.icon-blue{background:rgba(37,99,235,.1)}
.card-title{font-size:14px;font-weight:700;margin-bottom:3px;letter-spacing:-.15px}
.card-desc{font-size:11px;color:var(--text-dim);line-height:1.4;margin-bottom:8px}
.card-badge{display:inline-flex;align-items:center;gap:4px;font-family:'DM Mono',monospace;font-size:10px;padding:3px 9px;border-radius:20px;border:1px solid}
.card-body{padding:14px 18px;flex:1}
.card-footer{padding:10px 18px;border-top:1px solid var(--border);background:var(--surface2);display:flex;gap:8px;flex-wrap:wrap;align-items:center}

/* â”€â”€ Sub-nav items â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.sub-nav-item{display:flex;align-items:center;justify-content:space-between;padding:11px 12px;border:1px solid var(--border);border-radius:10px;margin-bottom:8px;text-decoration:none;color:var(--text);transition:all .2s;background:var(--white)}
.sub-nav-item:hover{border-color:var(--border2);box-shadow:var(--shadow-md);transform:translateY(-1px)}
.sub-nav-item:last-child{margin-bottom:0}
.sub-nav-item.disabled{opacity:.5;pointer-events:none}
.sub-nav-left{display:flex;align-items:center;gap:10px}
.sub-nav-icon{width:34px;height:34px;border-radius:9px;display:flex;align-items:center;justify-content:center;font-size:15px;flex-shrink:0}
.sni-purple{background:rgba(144,19,254,.1)}
.sni-muted{background:var(--surface2)}
.sni-orange{background:rgba(250,66,17,.1)}
.sni-blue{background:rgba(37,99,235,.1)}
.sni-green{background:rgba(22,163,74,.1)}
.sub-nav-title{font-size:12px;font-weight:600;margin-bottom:1px}
.sub-nav-meta{font-size:10px;color:var(--text-muted)}
.sub-nav-right{display:flex;align-items:center;gap:8px;flex-shrink:0}
.sub-nav-arrow{font-size:16px;color:var(--text-muted)}

/* â”€â”€ ZuÅ¼ycie â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.zuz-stats{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin-bottom:16px}
.zuz-stat{background:var(--surface2);border-radius:8px;padding:10px;border:1px solid var(--border);text-align:center}
.zuz-stat-label{font-size:10px;color:var(--text-muted);text-transform:uppercase;letter-spacing:.05em;font-family:'DM Mono',monospace;margin-bottom:4px}
.zuz-stat-val{font-size:17px;font-weight:700;font-variant-numeric:tabular-nums}

/* â”€â”€ Stats mini â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.stats-mini{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin-bottom:12px}
.stat-mini{background:var(--surface2);border-radius:8px;padding:9px 11px;border:1px solid var(--border)}
.stat-mini-label{font-size:10px;color:var(--text-muted);text-transform:uppercase;letter-spacing:.05em;font-family:'DM Mono',monospace;margin-bottom:3px}
.stat-mini-val{font-size:17px;font-weight:700;font-variant-numeric:tabular-nums;line-height:1}

/* â”€â”€ Placeholder sections â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.placeholder-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:12px}
@media(max-width:900px){.placeholder-grid{grid-template-columns:repeat(2,1fr)}}
.ph-slot{border:1.5px dashed var(--border2);border-radius:12px;padding:18px 16px;background:var(--surface2);display:flex;flex-direction:column;align-items:center;text-align:center;gap:8px;min-height:90px;justify-content:center}
.ph-slot-icon{font-size:22px;opacity:.4}
.ph-slot-title{font-size:12px;font-weight:600;color:var(--text-dim)}
.ph-slot-meta{font-size:10px;color:var(--text-muted)}
.ph-note{margin-top:16px;padding:12px 16px;border-radius:10px;border:1px solid var(--border);background:var(--surface2);font-size:11px;color:var(--text-muted);display:flex;align-items:center;gap:8px}
.section-label{font-size:10px;font-weight:700;text-transform:uppercase;letter-spacing:.07em;color:var(--text-muted);margin-bottom:8px;font-family:'DM Mono',monospace}
</style>
</head>
<body>

<header>
  <a href="index.html" class="back-btn">
    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M19 12H5M12 19l-7-7 7-7"/></svg>
    Centrum Operacyjne
  </a>
  <div class="h-center">
    <span class="page-title">Zakupy OpakowaÅ„</span>
  </div>
  <div class="date-pill" id="today-date"></div>
</header>

<main>

  <!-- Page intro â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <div class="page-intro">
    <img src="logo.svg" alt="OvocxMalinovi">
    <div class="page-intro-divider"></div>
    <div class="page-intro-text">
      <h1>Zakupy OpakowaÅ„</h1>
      <p>Stany magazynowe, zuÅ¼ycie, planowanie zakupÃ³w â€” wszystkie kategorie materiaÅ‚Ã³w opakowaniowych</p>
    </div>
    <div class="page-intro-stats">
      <div class="pi-stat">
        <div class="pi-stat-val" id="pi-plan" style="color:var(--orange)">â€”</div>
        <div class="pi-stat-lbl">Kart. plan 2026</div>
      </div>
      <div class="pi-stat">
        <div class="pi-stat-val" id="pi-stan" style="color:var(--green)">â€”</div>
        <div class="pi-stat-lbl">Stan mag. (rek.)</div>
      </div>
      <div class="pi-stat">
        <div class="pi-stat-val" id="pi-zuz" style="color:var(--purple)">â€”</div>
        <div class="pi-stat-lbl">ZuÅ¼ycie 2025</div>
      </div>
    </div>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       STAN MAGAZYNOWY â€” peÅ‚ny magazyn, na gÃ³rze strony
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div class="stan-widget">

    <div class="stan-widget-header">
      <div class="sw-icon">ğŸ“¦</div>
      <div class="sw-title-group">
        <div class="sw-title">Stan Magazynowy</div>
        <div class="sw-desc">Wszystkie opakowania â€” wszystkie magazyny</div>
      </div>
      <span class="stan-source-badge source-preset" id="stan-source-lbl">ğŸ“… 25.02.2026</span>
      <div class="sw-filters">
        <select class="stan-select" id="stan-f-mag" onchange="renderStan()">
          <option value="">Wszystkie magazyny</option>
        </select>
        <select class="stan-select" id="stan-f-grp" onchange="renderStan()">
          <option value="">Wszystkie grupy</option>
        </select>
        <a href="zakupy-stan.html" class="btn btn-orange btn-sm">â†’ PeÅ‚ny widok</a>
      </div>
      <div class="sw-stats">
        <div class="sw-stat">
          <div class="sw-stat-label">RekordÃ³w</div>
          <div class="sw-stat-val" style="color:var(--orange)" id="sw-rec">â€”</div>
        </div>
        <div class="sw-stat">
          <div class="sw-stat-label">Magazyny</div>
          <div class="sw-stat-val" id="sw-mag">â€”</div>
        </div>
        <div class="sw-stat">
          <div class="sw-stat-label">ÅÄ…cznie szt.</div>
          <div class="sw-stat-val" style="font-size:12px" id="sw-szt">â€”</div>
        </div>
      </div>
    </div>

    <div class="stan-widget-body">
      <div class="stan-table-wrap">
        <table class="stan-table">
          <thead>
            <tr>
              <th onclick="stanSort('nazwa')">Nazwa</th>
              <th onclick="stanSort('indeks')">Indeks</th>
              <th onclick="stanSort('magazyn')">Magazyn</th>
              <th onclick="stanSort('nazwa_grupy')">Grupa</th>
              <th onclick="stanSort('stan')" style="text-align:right">Stan</th>
              <th onclick="stanSort('jm')">Jm</th>
            </tr>
          </thead>
          <tbody id="stan-tbody"></tbody>
        </table>
      </div>
      <div class="stan-table-footer" id="stan-footer"></div>
    </div>

    <div class="stan-widget-footer">
      <span id="stan-custom-clear" style="display:none">
        <button class="btn btn-sm" onclick="clearCustomStan()">âœ• UsuÅ„ wÅ‚asny plik</button>
      </span>
      <div class="upload-zone-mini" onclick="document.getElementById('mag-file').click()"
           ondrop="handleDrop(event)" ondragover="event.preventDefault()" ondragleave="event.preventDefault()">
        <span>ğŸ“‚</span>
        <span id="upload-mini-lbl">Wgraj nowszy plik XLSX ze StreamSoft</span>
      </div>
      <input type="file" id="mag-file" accept=".xlsx,.xls" onchange="handleFile(event)">
      <span style="font-size:11px;color:var(--text-muted);font-family:'DM Mono',monospace;white-space:nowrap" id="stan-total-lbl"></span>
    </div>

  </div><!-- /stan-widget -->

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       BOX 1 â€” KARTONY / OPAKOWANIA ZBIORCZE
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <section class="cat-section cat-orange">
    <div class="cat-header">
      <div class="cat-icon ci-orange">ğŸ“¦</div>
      <div class="cat-info">
        <div class="cat-title">Kartony / Opakowania Zbiorcze</div>
        <div class="cat-desc">Kartony wysyÅ‚kowe i transportowe dla owocÃ³w miÄ™kkich â€” zuÅ¼ycie historyczne, planowanie i zakup na sezon 2026</div>
      </div>
      <span class="cat-badge badge-active">âœ“ Aktywny moduÅ‚</span>
    </div>
    <div class="cat-body">
      <div class="cat-tools-grid">

        <!-- Karta: ZuÅ¼ycie MateriaÅ‚Ã³w -->
        <div class="dash-card card-purple">
          <div class="card-top">
            <div class="card-icon-wrap icon-purple">ğŸ“Š</div>
            <div class="card-title">ZuÅ¼ycie MateriaÅ‚Ã³w</div>
            <div class="card-desc">Analiza zuÅ¼ycia opakowaÅ„ per magazyn i materiaÅ‚ â€” dane historyczne i bieÅ¼Ä…ce</div>
            <div class="card-badge badge-purple" id="zuz-badge">Åadowanieâ€¦</div>
          </div>
          <div class="card-body">
            <div class="zuz-stats">
              <div class="zuz-stat">
                <div class="zuz-stat-label">Rekordy 2025</div>
                <div class="zuz-stat-val" id="zuz-cnt" style="color:var(--purple)">â€”</div>
              </div>
              <div class="zuz-stat">
                <div class="zuz-stat-label">Magazyny</div>
                <div class="zuz-stat-val" id="zuz-mag">â€”</div>
              </div>
              <div class="zuz-stat">
                <div class="zuz-stat-label">Typy mat.</div>
                <div class="zuz-stat-val" id="zuz-typy">â€”</div>
              </div>
            </div>
            <div class="section-label">Wybierz rok</div>
            <a href="zuzycie-2025.html" class="sub-nav-item">
              <div class="sub-nav-left">
                <div class="sub-nav-icon sni-purple">ğŸ“</div>
                <div>
                  <div class="sub-nav-title">ZuÅ¼ycie 2025</div>
                  <div class="sub-nav-meta" id="zuz-meta-2025">IVâ€“XI 2025 Â· Å‚adowanieâ€¦</div>
                </div>
              </div>
              <div class="sub-nav-right">
                <span class="card-badge badge-locked">ğŸ”’ Historyczne</span>
                <span class="sub-nav-arrow">â€º</span>
              </div>
            </a>
            <a href="#" class="sub-nav-item disabled">
              <div class="sub-nav-left">
                <div class="sub-nav-icon sni-muted">ğŸ“</div>
                <div>
                  <div class="sub-nav-title">ZuÅ¼ycie 2026</div>
                  <div class="sub-nav-meta">Dane bÄ™dÄ… uzupeÅ‚niane na bieÅ¼Ä…co</div>
                </div>
              </div>
              <div class="sub-nav-right">
                <span class="card-badge badge-pending">W przygotowaniu</span>
                <span class="sub-nav-arrow" style="opacity:.4">â€º</span>
              </div>
            </a>
          </div>
          <div class="card-footer">
            <a href="zuzycie-2025.html" class="btn btn-purple">ğŸ“Š OtwÃ³rz ZuÅ¼ycie 2025</a>
          </div>
        </div>

        <!-- Karta: Planowanie ZakupÃ³w 2026 -->
        <div class="dash-card card-blue">
          <div class="card-top">
            <div class="card-icon-wrap icon-blue">ğŸ›’</div>
            <div class="card-title"><a href="zakupy-plan2026.html" style="color:inherit;text-decoration:none">Planowanie ZakupÃ³w â€º</a></div>
            <div class="card-desc">Plan kartonÃ³w na sezon 2026 â€” proporcje ZP 2025 Ã— wolumen 2026 per klient/owoc. Wizard RFQ + PDF/Excel.</div>
            <div class="card-badge badge-active" id="plan-badge">Plan 2026</div>
          </div>
          <div class="card-body">
            <div class="stats-mini" id="plan-mini-stats" style="margin-bottom:14px">
              <div class="stat-mini"><div class="stat-mini-label">Kart. plan 2026</div><div class="stat-mini-val" id="p26-kart" style="color:var(--blue)">â€”</div></div>
              <div class="stat-mini"><div class="stat-mini-label">KlientÃ³w z planem</div><div class="stat-mini-val" id="p26-kl">â€”</div></div>
              <div class="stat-mini"><div class="stat-mini-label">Baza (kart. 2025)</div><div class="stat-mini-val" id="p26-hist" style="font-size:13px;color:var(--text-dim)">â€”</div></div>
            </div>
            <div class="section-label">NarzÄ™dzia</div>
            <a href="zakupy-plan2026.html" class="sub-nav-item">
              <div class="sub-nav-left">
                <div class="sub-nav-icon sni-blue">ğŸ“‹</div>
                <div>
                  <div class="sub-nav-title">Wizard zakupowy â€” RFQ</div>
                  <div class="sub-nav-meta">Generuj zapytanie ofertowe PDF + Excel</div>
                </div>
              </div>
              <div class="sub-nav-right">
                <span class="card-badge badge-active">Aktywny</span>
                <span class="sub-nav-arrow">â€º</span>
              </div>
            </a>
            <a href="zakupy-klienci.html" class="sub-nav-item">
              <div class="sub-nav-left">
                <div class="sub-nav-icon sni-orange">ğŸ“¦</div>
                <div>
                  <div class="sub-nav-title">Konfekcja per klient</div>
                  <div class="sub-nav-meta">Zestawienie opakowaÅ„ wg klientÃ³w 2025</div>
                </div>
              </div>
              <span class="sub-nav-arrow">â€º</span>
            </a>
            <a href="kartony-dostawcy.html" class="sub-nav-item">
              <div class="sub-nav-left">
                <div class="sub-nav-icon sni-green">ğŸ­</div>
                <div>
                  <div class="sub-nav-title">Dostawcy kartonÃ³w</div>
                  <div class="sub-nav-meta">Baza dostawcÃ³w z danymi kontaktowymi</div>
                </div>
              </div>
              <span class="sub-nav-arrow">â€º</span>
            </a>
            <a href="zakupy-harmonogram.html" class="sub-nav-item">
              <div class="sub-nav-left">
                <div class="sub-nav-icon sni-orange">ğŸ“…</div>
                <div>
                  <div class="sub-nav-title">Harmonogram zakupÃ³w</div>
                  <div class="sub-nav-meta">Terminy i planowane zamÃ³wienia</div>
                </div>
              </div>
              <span class="sub-nav-arrow">â€º</span>
            </a>
          </div>
          <div class="card-footer">
            <a href="zakupy-plan2026.html" class="btn btn-orange">â†’ Wizard RFQ 2026</a>
            <span style="flex:1"></span>
            <a href="https://github.com/janlipczynski-admin/ovocxmalinovi-brain-/commits/main/planowanie-data.js"
               target="_blank" class="btn btn-sm" style="font-size:10px">ğŸ• Historia</a>
          </div>
        </div>

      </div><!-- /cat-tools-grid -->
    </div>
  </section>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       BOX 2 â€” OPAKOWANIA JEDNOSTKOWE
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <section class="cat-section cat-blue">
    <div class="cat-header">
      <div class="cat-icon ci-blue">ğŸ·ï¸</div>
      <div class="cat-info">
        <div class="cat-title">Opakowania Jednostkowe</div>
        <div class="cat-desc">Etykiety, tacki, folie, woreczki, Å‚Ã³deczki â€” opakowania bezpoÅ›rednio dla konsumenta</div>
      </div>
      <span class="cat-badge badge-pending">W budowie</span>
    </div>
    <div class="cat-body">
      <div class="placeholder-grid">
        <div class="ph-slot"><div class="ph-slot-icon">ğŸ“Š</div><div class="ph-slot-title">Stan magazynowy OJ</div><div class="ph-slot-meta">Etykiety, tacki, folie</div></div>
        <div class="ph-slot"><div class="ph-slot-icon">ğŸ“ˆ</div><div class="ph-slot-title">ZuÅ¼ycie OJ 2025</div><div class="ph-slot-meta">Per magazyn i format</div></div>
        <div class="ph-slot"><div class="ph-slot-icon">ğŸ›’</div><div class="ph-slot-title">Planowanie zakupÃ³w OJ</div><div class="ph-slot-meta">RFQ â€” opakowania jednostkowe</div></div>
      </div>
      <div class="ph-note"><span>â„¹ï¸</span><span>Dane historyczne dostÄ™pne w ZuÅ¼ycie 2025 (filtr: Opakowania-Jednostkowe)</span></div>
    </div>
  </section>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       BOX 3 â€” ZAPINKI, TAÅšMY, INNE
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <section class="cat-section cat-green">
    <div class="cat-header">
      <div class="cat-icon ci-green">ğŸ”©</div>
      <div class="cat-info">
        <div class="cat-title">Zapinki, TaÅ›my, Inne</div>
        <div class="cat-desc">Zapinki plastikowe, taÅ›my klejÄ…ce, wkÅ‚adki absorpcyjne i pozostaÅ‚e materiaÅ‚y pomocnicze</div>
      </div>
      <span class="cat-badge badge-pending">W budowie</span>
    </div>
    <div class="cat-body">
      <div class="placeholder-grid">
        <div class="ph-slot"><div class="ph-slot-icon">ğŸ“Š</div><div class="ph-slot-title">Stan magazynowy</div><div class="ph-slot-meta">Zapinki, taÅ›my, wkÅ‚adki</div></div>
        <div class="ph-slot"><div class="ph-slot-icon">ğŸ›’</div><div class="ph-slot-title">Planowanie zakupÃ³w</div><div class="ph-slot-meta">RFQ â€” materiaÅ‚y pomocnicze</div></div>
        <div class="ph-slot"><div class="ph-slot-icon">ğŸ“‹</div><div class="ph-slot-title">Normatywy zuÅ¼ycia</div><div class="ph-slot-meta">IloÅ›Ä‡ na karton / na kg</div></div>
      </div>
      <div class="ph-note"><span>â„¹ï¸</span><span>Dane historyczne dostÄ™pne w ZuÅ¼ycie 2025 (filtr: Opakowania-WkÅ‚adki absorpcyjne)</span></div>
    </div>
  </section>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       BOX 4 â€” PALETY
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <section class="cat-section cat-purple">
    <div class="cat-header">
      <div class="cat-icon ci-purple">ğŸªµ</div>
      <div class="cat-info">
        <div class="cat-title">Palety</div>
        <div class="cat-desc">Palety drewniane i plastikowe â€” stany, rotacja, planowanie zakupÃ³w i rozliczenia z magazynami</div>
      </div>
      <span class="cat-badge badge-pending">W budowie</span>
    </div>
    <div class="cat-body">
      <div class="placeholder-grid">
        <div class="ph-slot"><div class="ph-slot-icon">ğŸ“Š</div><div class="ph-slot-title">Stan palet</div><div class="ph-slot-meta">Per magazyn i typ</div></div>
        <div class="ph-slot"><div class="ph-slot-icon">ğŸ”„</div><div class="ph-slot-title">Rotacja palet</div><div class="ph-slot-meta">Wydania / przyjÄ™cia</div></div>
        <div class="ph-slot"><div class="ph-slot-icon">ğŸ›’</div><div class="ph-slot-title">Planowanie zakupÃ³w</div><div class="ph-slot-meta">RFQ â€” palety sezon 2026</div></div>
      </div>
      <div class="ph-note"><span>â„¹ï¸</span><span>ModuÅ‚ w przygotowaniu â€” rozliczenia palet prowadzone aktualnie poza systemem OxM Brain</span></div>
    </div>
  </section>

</main>

<script>
// â”€â”€ Date display â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const today = new Date();
document.getElementById('today-date').textContent =
  today.toLocaleDateString('pl-PL',{day:'2-digit',month:'2-digit',year:'numeric'});

// â”€â”€ ZuÅ¼ycie stats â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
if (window.ZUZYCIE_DATA) {
  const rek = window.ZUZYCIE_DATA.rekordy;
  const mags  = new Set(rek.map(r => r.magazyn));
  const typy  = new Set(rek.map(r => r.typ_materialu));
  const mats  = new Set(rek.map(r => r.surowiec_nazwa));
  document.getElementById('zuz-cnt').textContent   = rek.length.toLocaleString('pl-PL');
  document.getElementById('zuz-mag').textContent   = mags.size;
  document.getElementById('zuz-typy').textContent  = typy.size;
  document.getElementById('zuz-badge').textContent = rek.length + ' rekordÃ³w Â· 2025';
  document.getElementById('zuz-meta-2025').textContent =
    window.ZUZYCIE_DATA.zakres + ' Â· ' + rek.length + ' rekordÃ³w Â· ' + mats.size + ' materiaÅ‚Ã³w';
  document.getElementById('pi-zuz').textContent = rek.length.toLocaleString('pl-PL');
}

// â”€â”€ Stan Magazynowy â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const LS_KEY = 'oxm_stan_custom_v1';
let stanData = null, stanDate = '', stanSortCol = 'stan', stanSortDir = -1;

function stanInit() {
  try {
    const raw = localStorage.getItem(LS_KEY);
    if (raw) {
      const custom = JSON.parse(raw);
      stanData = custom.rekordy; stanDate = custom.date;
      document.getElementById('stan-source-lbl').textContent = 'ğŸ“‚ ' + custom.date + ' (wÅ‚asny plik)';
      document.getElementById('stan-source-lbl').className = 'stan-source-badge source-upload';
      document.getElementById('stan-custom-clear').style.display = 'inline';
      document.getElementById('upload-mini-lbl').textContent = 'â†º ZastÄ…p plik nowszym z StreamSoft';
    }
  } catch(e){}
  if (!stanData && window.STANY_DATA) { stanData = window.STANY_DATA.rekordy; stanDate = window.STANY_DATA.data; }
  if (!stanData) return;
  const mags = [...new Set(stanData.map(r => r.magazyn))].sort((a,b) => a.localeCompare(b,'pl'));
  const grps = [...new Set(stanData.map(r => r.nazwa_grupy))].sort((a,b) => a.localeCompare(b,'pl'));
  const selMag = document.getElementById('stan-f-mag');
  const selGrp = document.getElementById('stan-f-grp');
  mags.forEach(m => selMag.appendChild(new Option(m,m)));
  grps.forEach(g => selGrp.appendChild(new Option(g,g)));
  document.getElementById('pi-stan').textContent = stanData.length.toLocaleString('pl-PL');
  renderStan();
}

function stanSort(col) {
  stanSortDir = stanSortCol === col ? stanSortDir * -1 : (col === 'stan' ? -1 : 1);
  stanSortCol = col;
  document.querySelectorAll('.stan-table th').forEach(th => {
    th.classList.remove('sort-asc','sort-desc');
    if (th.getAttribute('onclick') === `stanSort('${col}')`)
      th.classList.add(stanSortDir === 1 ? 'sort-asc' : 'sort-desc');
  });
  renderStan();
}

function renderStan() {
  if (!stanData) return;
  const mag = document.getElementById('stan-f-mag').value;
  const grp = document.getElementById('stan-f-grp').value;
  let rows = stanData.filter(r => (!mag || r.magazyn === mag) && (!grp || r.nazwa_grupy === grp));
  rows.sort((a,b) => {
    const av = a[stanSortCol], bv = b[stanSortCol];
    if (av == null && bv == null) return 0;
    if (av == null) return 1; if (bv == null) return -1;
    return (typeof av === 'string' ? av.localeCompare(bv,'pl') : av - bv) * stanSortDir;
  });
  const totalStan = rows.reduce((s,r) => s + (r.stan||0), 0);
  const magsN = new Set(rows.map(r => r.magazyn)).size;

  document.getElementById('sw-rec').textContent = rows.length.toLocaleString('pl-PL');
  document.getElementById('sw-mag').textContent = magsN;
  document.getElementById('sw-szt').textContent = totalStan.toLocaleString('pl-PL',{maximumFractionDigits:0});
  document.getElementById('stan-total-lbl').textContent =
    'ÅÄ…cznie: ' + totalStan.toLocaleString('pl-PL',{maximumFractionDigits:0}) + ' szt.';

  const GRP_CLR = {
    'Etykiety':'var(--purple)',
    'Opakowania-Transportowe':'var(--orange)',
    'Opakowania-Jednostkowe':'var(--blue)',
    'Opakowania-Zbiorcze':'var(--green)',
    'Opakowania-WkÅ‚adki absorpcyjne':'var(--yellow)'
  };
  document.getElementById('stan-tbody').innerHTML = rows.map(r => {
    const clr = GRP_CLR[r.nazwa_grupy] || 'var(--text-dim)';
    return `<tr>
      <td title="${r.nazwa}" style="font-weight:500;max-width:220px;overflow:hidden;text-overflow:ellipsis">${r.nazwa||'â€”'}</td>
      <td style="font-size:11px;color:var(--text-muted)">${r.indeks||'â€”'}</td>
      <td style="font-size:11px">${r.magazyn}</td>
      <td><span style="font-size:10px;font-weight:700;color:${clr}">${r.nazwa_grupy||'â€”'}</span></td>
      <td class="num-cell" style="font-weight:700">${(r.stan||0).toLocaleString('pl-PL',{maximumFractionDigits:0})}</td>
      <td style="font-size:11px;color:var(--text-muted)">${r.jm||''}</td>
    </tr>`;
  }).join('') || '<tr><td colspan="6" style="text-align:center;padding:24px;color:var(--text-muted)">Brak wynikÃ³w</td></tr>';

  document.getElementById('stan-footer').textContent =
    'WyÅ›wietlono ' + rows.length + ' z ' + stanData.length + ' rekordÃ³w Â· stan na ' + stanDate;
}

function handleDrop(e) { e.preventDefault(); const f = e.dataTransfer.files[0]; if (f) processFile(f); }
function handleFile(e) { const f = e.target.files[0]; if (f) processFile(f); }

function processFile(file) {
  const reader = new FileReader();
  reader.onload = function(ev) {
    try {
      const wb = XLSX.read(ev.target.result, { type:'array' });
      const rekordy = [];
      const m = file.name.match(/(\d{1,2}[.\-\/]\d{1,2}[.\-\/]\d{4})/);
      const dateStr = m ? m[1].replace(/[-\/]/g,'.') : file.name.replace(/\.xlsx?$/i,'');
      wb.SheetNames.forEach(sname => {
        const ws  = wb.Sheets[sname];
        const raw = XLSX.utils.sheet_to_json(ws, { header:1, defval:'' });
        if (raw.length < 2) return;
        const headers = raw[0].map(String);
        const idxNazwa = headers.findIndex(h => h.toLowerCase().includes('nazwa'));
        const idxStan  = headers.findIndex(h => h.toLowerCase() === 'stan');
        const idxJm    = headers.findIndex(h => h.toLowerCase() === 'jm');
        const idxGrp   = headers.findIndex(h => h.toLowerCase().includes('nazwa grupy') || h.toLowerCase().includes('nazwa_grupy'));
        const idxKGrp  = headers.findIndex(h => h.toLowerCase().includes('kod grupy') || h.toLowerCase().includes('kod_grupy'));
        const idxWart  = headers.findIndex(h => h.toLowerCase().includes('wartoÅ›Ä‡ zakupu') || h.toLowerCase().includes('wartosc'));
        raw.slice(1).forEach(row => {
          if (!row.some(c => c !== '')) return;
          rekordy.push({
            indeks:      String(row[0]||'').trim(),
            nazwa:       String(row[idxNazwa >= 0 ? idxNazwa : 2]||'').trim(),
            stan:        typeof row[idxStan >= 0 ? idxStan : 3] === 'number' ? row[idxStan >= 0 ? idxStan : 3] : 0,
            jm:          String(row[idxJm >= 0 ? idxJm : 10]||'szt.').trim(),
            wartosc:     typeof row[idxWart >= 0 ? idxWart : 4] === 'number' ? Math.round(row[idxWart >= 0 ? idxWart : 4]*100)/100 : 0,
            kod_grupy:   String(row[idxKGrp >= 0 ? idxKGrp : 12]||'').trim(),
            nazwa_grupy: String(row[idxGrp >= 0 ? idxGrp : 13]||'').trim(),
            magazyn:     sname.trim()
          });
        });
      });
      if (!rekordy.length) { alert('Nie znaleziono danych w pliku.'); return; }
      try { localStorage.setItem(LS_KEY, JSON.stringify({ date:dateStr, rekordy })); } catch(e){}
      stanData = rekordy; stanDate = dateStr;
      document.getElementById('stan-source-lbl').textContent = 'ğŸ“‚ ' + dateStr + ' (wÅ‚asny plik)';
      document.getElementById('stan-source-lbl').className = 'stan-source-badge source-upload';
      document.getElementById('stan-custom-clear').style.display = 'inline';
      document.getElementById('upload-mini-lbl').textContent = 'â†º ZastÄ…p plik nowszym z StreamSoft';
      const selMag = document.getElementById('stan-f-mag');
      const selGrp = document.getElementById('stan-f-grp');
      selMag.innerHTML = '<option value="">Wszystkie magazyny</option>';
      selGrp.innerHTML = '<option value="">Wszystkie grupy</option>';
      [...new Set(rekordy.map(r => r.magazyn))].sort((a,b)=>a.localeCompare(b,'pl')).forEach(m => selMag.appendChild(new Option(m,m)));
      [...new Set(rekordy.map(r => r.nazwa_grupy).filter(Boolean))].sort((a,b)=>a.localeCompare(b,'pl')).forEach(g => selGrp.appendChild(new Option(g,g)));
      renderStan();
    } catch(err) { alert('BÅ‚Ä…d wczytywania pliku:\n' + err.message); }
  };
  reader.readAsArrayBuffer(file);
}

function clearCustomStan() {
  localStorage.removeItem(LS_KEY);
  stanData = null; stanDate = '';
  document.getElementById('stan-custom-clear').style.display = 'none';
  document.getElementById('stan-source-lbl').textContent = 'ğŸ“… 25.02.2026';
  document.getElementById('stan-source-lbl').className = 'stan-source-badge source-preset';
  document.getElementById('upload-mini-lbl').textContent = 'Wgraj nowszy plik XLSX ze StreamSoft';
  document.getElementById('mag-file').value = '';
  const selMag = document.getElementById('stan-f-mag');
  const selGrp = document.getElementById('stan-f-grp');
  selMag.innerHTML = '<option value="">Wszystkie magazyny</option>';
  selGrp.innerHTML = '<option value="">Wszystkie grupy</option>';
  stanInit();
}

stanInit();

// â”€â”€ Plan 2026 mini-stats â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
(function() {
  if (!window.PLAN2026_DATA) return;
  const { totals, rows } = window.PLAN2026_DATA;
  const kliZPlanem = new Set(rows.filter(r=>r.kartony_2026).map(r=>r.klient)).size;
  const fmt = n => n == null ? 'â€”' : Math.round(n).toLocaleString('pl-PL');
  document.getElementById('p26-kart').textContent = fmt(totals.kartony_2026);
  document.getElementById('p26-kl').textContent   = kliZPlanem + ' / ' + new Set(rows.map(r=>r.klient)).size;
  document.getElementById('p26-hist').textContent = fmt(totals.kartony_2025);
  document.getElementById('plan-badge').textContent = 'Plan 2026 Â· aktywny';
  document.getElementById('pi-plan').textContent = fmt(totals.kartony_2026);
})();
</script>
</body>
</html>
